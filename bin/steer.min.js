/*
This file is part of Steer.js

Steer.js is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or any later version.

Steer.js is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with Steer.js  If not, see <http://www.gnu.org/licenses/>.
*/
var steer;!function(steer){var Event=function(){function Event(type,target,values){this.type=type,target&&(this.target=target),values&&(this.values=values)}return Event.prototype.toString=function(){return"[event] type: "+this.type+" target: "+this.target+" values: "+this.values},Event.LOGIC_UPDATE="logicUpdate",Event.RENDER_UPDATE="renderUpdate",Event.RENDER="render",Event.RESIZE="resize",Event}();steer.Event=Event;var EventDispatcher=function(){function EventDispatcher(){this.callBacks=[]}return EventDispatcher.prototype.addEvent=function(type,func){null==this.callBacks[type]&&(this.callBacks[type]=[]),this.callBacks[type].push({func:func})},EventDispatcher.prototype.removeEvent=function(type,func){if(null!=this.callBacks[type])for(var callbackLen=this.callBacks[type].length,k=0;callbackLen>k;k++)if(this.callBacks[type][k].func===func){this.callBacks[type].splice(k,1);break}},EventDispatcher.prototype.fireEvent=function(event){if(null!=this.callBacks[event.type])for(var callbackLen=this.callBacks[event.type].length,k=0;callbackLen>k;k++)this.callBacks[event.type][k].func(event)},EventDispatcher}();steer.EventDispatcher=EventDispatcher}(steer||(steer={}));var steer;!function(steer){var MathUtil=function(){function MathUtil(){}return MathUtil.getElementPosition=function(element){for(var elem=element,tagname="",x=0,y=0;"object"==typeof elem&&"undefined"!=typeof elem.tagName;)y+=elem.offsetTop,x+=elem.offsetLeft,tagname=elem.tagName.toUpperCase(),"BODY"==tagname&&(elem=0),"object"==typeof elem&&"object"==typeof elem.offsetParent&&(elem=elem.offsetParent);return{x:x,y:y}},MathUtil.dist=function(x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;return Math.sqrt(dx*dx+dy*dy)},MathUtil.isPointOnWall=function(sx,sy,ex,ey,checkX,checkY){var dist1=MathUtil.dist(sx,sy,checkX,checkY),dist2=MathUtil.dist(checkX,checkY,ex,ey),dist3=MathUtil.dist(sx,sy,ex,ey);return dist1+dist2==dist3},MathUtil.range=function(min,max,round){return"undefined"==typeof round&&(round=!0),round?Math.floor(Math.random()*(max-min+1))+min:Math.random()*(max-min)+min},MathUtil.degree=function(value){return value/MathUtil.ONED},MathUtil.radian=function(value){return value*MathUtil.ONED},MathUtil.rgbToHex=function(r,g,b){return"#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1)},MathUtil.hexToRgb=function(hex){isNaN(hex)||(hex="#"+hex.toString(16));var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},MathUtil.clamp=function(val,min,max){return Math.max(min,Math.min(max,val))},MathUtil.angleBtweenPt=function(pt1,pt2){return Math.atan2(pt2.y-pt1.y,pt2.x-pt1.x)},MathUtil.map=function(value,low,high,low2,high2){var percent=(value-low)/(high-low);return low2+percent*(high2-low2)},MathUtil.rectCircleCollide=function(circle,rect){var distX=Math.abs(circle.x-rect.x-rect.w/2),distY=Math.abs(circle.y-rect.y-rect.h/2);if(distX>rect.w/2+circle.r)return!1;if(distY>rect.h/2+circle.r)return!1;if(distX<=rect.w/2)return!0;if(distY<=rect.h/2)return!0;var dx=distX-rect.w/2,dy=distY-rect.h/2;return dx*dx+dy*dy<=circle.r*circle.r},MathUtil.intersectLineLine=function(a1,a2,b1,b2){var result={hit:!1,data:null,denom:null},denom=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(result.denom=denom,0==denom)return result;var a=a1.y-b1.y,b=a1.x-b1.x,nr1=(b2.x-b1.x)*a-(b2.y-b1.y)*b,nr2=(a2.x-a1.x)*a-(a2.y-a1.y)*b;if(a=nr1/denom,b=nr2/denom,a>0&&1>a&&b>0&&1>b){var intersectX=a1.x+a*(a2.x-a1.x),intersectY=a1.y+a*(a2.y-a1.y);result.hit=!0,result.data=[new steer.Vector(intersectX,intersectY)]}return result},MathUtil.intersectCircleLine=function(a1,a2,c,r){var result={hit:!1,data:null},a=(a2.x-a1.x)*(a2.x-a1.x)+(a2.y-a1.y)*(a2.y-a1.y),b=2*((a2.x-a1.x)*(a1.x-c.x)+(a2.y-a1.y)*(a1.y-c.y)),cc=c.x*c.x+c.y*c.y+a1.x*a1.x+a1.y*a1.y-2*(c.x*a1.x+c.y*a1.y)-r*r,deter=b*b-4*a*cc;if(0>deter);else if(0==deter);else{var e=Math.sqrt(deter),u1=(-b+e)/(2*a),u2=(-b-e)/(2*a),intersectData=[];u1>0&&1>u1&&intersectData.push(steer.Vector.lerp(a1,a2,u1)),u2>0&&1>u2&&intersectData.push(steer.Vector.lerp(a1,a2,u2)),intersectData.length>0&&(result.hit=!0,result.data=intersectData)}return result},MathUtil.ONED=Math.PI/180,MathUtil}();steer.MathUtil=MathUtil}(steer||(steer={}));var steer;!function(steer){var Vector=function(){function Vector(x,y){"undefined"==typeof x&&(x=0),"undefined"==typeof y&&(y=0),this.x=x,this.y=y}return Vector.add=function(v1,v2){return new Vector(v1.x+v2.x,v1.y+v2.y)},Vector.sub=function(v1,v2){return new Vector(v1.x-v2.x,v1.y-v2.y)},Vector.mult=function(v1,value){return new Vector(v1.x*value,v1.y*value)},Vector.div=function(v,value){return new Vector(v.x/value,v.y/value)},Vector.fromAngle=function(angle,magnitude){"undefined"==typeof magnitude&&(magnitude=1);var newVector=new Vector;return newVector.x=Math.cos(angle)*magnitude,newVector.y=Math.sin(angle)*magnitude,newVector},Vector.setAngle=function(vector,angle){var mag=vector.mag();vector.x=Math.cos(angle)*mag,vector.y=Math.sin(angle)*mag},Vector.fromb2Vec=function(b2Vec,multiply30){return"undefined"==typeof multiply30&&(multiply30=!1),multiply30?new Vector(30*b2Vec.x,30*b2Vec.y):new Vector(b2Vec.x,b2Vec.y)},Vector.lerp=function(v1,v2,fraction){var tempV=Vector.sub(v2,v1);return tempV.mult(fraction),tempV.add(v1),tempV},Vector.angleBetween=function(a,b){var dotValue=a.dot(b);return Math.acos(dotValue/(a.mag()*b.mag()))},Vector.random=function(xmin,xmax,ymin,ymax){var result=new steer.Vector;return result.x=steer.MathUtil.map(Math.random(),0,1,xmin,xmax),result.y=steer.MathUtil.map(Math.random(),0,1,ymin,ymax),result},Vector.getNormalPoint=function(point,linePtA,linePtB){var pa=Vector.sub(point,linePtA),ba=Vector.sub(linePtB,linePtA);return ba.normalize().mult(pa.dot(ba)),Vector.add(linePtA,ba)},Vector.equal=function(a,b){return a.x==b.x&&a.y==b.y},Vector.distanceSq=function(a,b){var dx=a.x-b.x,dy=a.y-b.y;return dx*dx+dy*dy},Vector.distance=function(a,b){var dx=a.x-b.x,dy=a.y-b.y;return Math.sqrt(dx*dx+dy*dy)},Vector.prototype.setTo=function(x,y){return this.x=x,this.y=y,this},Vector.prototype.clone=function(){return new Vector(this.x,this.y)},Vector.prototype.mag=function(){var toX=this.x,toY=this.y;return Math.sqrt(toX*toX+toY*toY)},Vector.prototype.magSq=function(){var toX=this.x,toY=this.y;return toX*toX+toY*toY},Vector.prototype.add=function(other){return this.x+=other.x,this.y+=other.y,this},Vector.prototype.addm=function(value){return this.x+=value,this.y+=value,this},Vector.prototype.addxy=function(x,y){return this.x+=x,this.y+=y,this},Vector.prototype.subxy=function(x,y){return this.x-=x,this.y-=y,this},Vector.prototype.sub=function(other){return this.x-=other.x,this.y-=other.y,this},Vector.prototype.subm=function(value){return this.x-=value,this.y-=value,this},Vector.prototype.mult=function(value){return this.x*=value,this.y*=value,this},Vector.prototype.div=function(v){return this.x/=v,this.y/=v,this},Vector.prototype.dist=function(other){var dx=this.x-other.x,dy=this.y-other.y;return Math.sqrt(dx*dx+dy*dy)},Vector.prototype.distSq=function(other){var dx=this.x-other.x,dy=this.y-other.y;return dx*dx+dy*dy},Vector.prototype.dot=function(other){return this.x*other.x+this.y*other.y},Vector.prototype.normalize=function(){var m=this.mag();return m>0&&this.div(m),this},Vector.prototype.normalizeThanMult=function(value){return this.normalize(),this.mult(value),this},Vector.prototype.limit=function(highVal){return this.mag()>highVal&&(this.normalize(),this.mult(highVal)),this},Vector.prototype.min=function(lowVal){return this.mag()<lowVal&&(this.normalize(),this.mult(lowVal)),this},Vector.prototype.heading=function(){return-Math.atan2(-this.y,this.x)},Vector.prototype.headingDegree=function(){var deg=-Math.atan2(-this.y,this.x);return deg/steer.MathUtil.ONED},Vector.prototype.decimal=function(decimal){var dval=Math.pow(10,decimal);return this.x=Math.round(this.x*dval)/dval,this.y=Math.round(this.y*dval)/dval,this},Vector.prototype.isZero=function(){return 0==this.x&&0==this.y},Vector.prototype.makeB2Vec=function(divide30){return"undefined"==typeof divide30&&(divide30=!1),divide30?new box2d.b2Vec2(this.x/30,this.y/30):new box2d.b2Vec2(this.x,this.y)},Vector.prototype.fromB2Vec=function(other,time30){"undefined"==typeof time30&&(time30=!0),this.x=30*other.x,this.y=30*other.y},Vector.prototype.reverse=function(){return this.x*=-1,this.y*=-1,this},Vector.prototype.toString=function(decimal){if("undefined"==typeof decimal&&(decimal=2),decimal>0){var dval=Math.pow(10,decimal),mag=Math.round(this.mag()*dval)/dval;return"("+Math.round(this.x*dval)/dval+","+Math.round(this.y*dval)/dval+") mag:"+mag}return"("+this.x+","+this.y+") mag: "+this.mag()},Vector}();steer.Vector=Vector}(steer||(steer={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},steer;!function(steer){var SteerTimer=function(_super){function SteerTimer(TPS){_super.call(this),this.TPS=TPS,this.tpsValue=this.TPS/1e3,this.logicTicker=null}return __extends(SteerTimer,_super),SteerTimer.prototype.start=function(){this.accumulateLogicTime=0,this.lastLogicUpdate=Date.now(),this.LogicPerMsec=Math.round(1e3/this.TPS),this.logicIntervalUpdate()},SteerTimer.prototype.updateTPS=function(value){this.stop(),this.TPS=value,this.start()},SteerTimer.prototype.isRunning=function(){return null!=this.requestAnimateId},SteerTimer.prototype.stop=function(){this.requestAnimateId&&(window.cancelAnimationFrame(this.requestAnimateId),this.requestAnimateId=void 0)},SteerTimer.prototype.logicIntervalUpdate=function(){var timeDiff=Date.now()-this.lastLogicUpdate;for(this.accumulateLogicTime+=timeDiff,this.lastLogicUpdate=Date.now();this.accumulateLogicTime>this.LogicPerMsec;)this.accumulateLogicTime-=this.LogicPerMsec,this.fireEvent(new steer.Event(steer.Event.LOGIC_UPDATE,this,{delta:this.LogicPerMsec}));var intergrate=this.accumulateLogicTime/this.LogicPerMsec;this.fireEvent(new steer.Event(steer.Event.RENDER_UPDATE,this,{delta:intergrate}));var self=this;this.requestAnimateId=window.requestAnimationFrame(function(){self.logicIntervalUpdate()})},SteerTimer}(steer.EventDispatcher);steer.SteerTimer=SteerTimer}(steer||(steer={}));var steer;!function(steer){!function(_item){var ItemBase=function(){function ItemBase(name){var objectName=this.constructor.name;null==name&&(name=objectName+"_"+ItemBase.addCounter(objectName)),this.name=name,this.type=objectName}return ItemBase.addCounter=function(type){return null==ItemBase.uniqueNameCounters[type]&&(ItemBase.uniqueNameCounters[type]=0),ItemBase.uniqueNameCounters[type]++,ItemBase.uniqueNameCounters[type].toString(36)},ItemBase.prototype.remove=function(){},ItemBase.uniqueNameCounters={},ItemBase}();_item.ItemBase=ItemBase;var ItemEntity=function(_super){function ItemEntity(b2body,name){_super.call(this,name),this.b2body=b2body,this.diffPosition=new box2d.b2Vec2(0,0),this.diffRotation=0}return __extends(ItemEntity,_super),ItemEntity.prototype.getb2X=function(){return this.b2body.GetPosition().x},ItemEntity.prototype.getb2Y=function(){return this.b2body.GetPosition().y},ItemEntity.prototype.getPixelX=function(){return 30*this.b2body.GetPosition().x},ItemEntity.prototype.getPixelY=function(){return 30*this.b2body.GetPosition().y},ItemEntity.prototype.getb2Position=function(){return new steer.Vector(this.b2body.GetPosition().x,this.b2body.GetPosition().y)},ItemEntity.prototype.getSteerPosition=function(){return new steer.Vector(30*this.b2body.GetPosition().x,30*this.b2body.GetPosition().y)},ItemEntity.prototype.setb2Position=function(x,y){this.b2body.SetPosition(new box2d.b2Vec2(x,y))},ItemEntity.prototype.setSteerPosition=function(x,y){this.b2body.SetPosition(new box2d.b2Vec2(x/30,y/30))},ItemEntity.prototype.updateBeforeStep=function(){this.dynamic&&(this.lastPosition=this.b2body.GetPosition().Clone(),this.lastRotation=this.b2body.GetAngle())},ItemEntity.prototype.updateAfterStep=function(){if(this.dynamic){var diffx=this.b2body.GetPosition().x-this.lastPosition.x,diffy=this.b2body.GetPosition().y-this.lastPosition.y;this.diffPosition=new box2d.b2Vec2(diffx,diffy),this.diffRotation=this.b2body.GetAngle()-this.lastRotation}},ItemEntity.prototype.setDynamic=function(isDynamic){this.b2body&&(this.b2body.GetType()===box2d.b2BodyType.b2_dynamicBody?this.b2body.SetType(box2d.b2BodyType.b2_staticBody):this.b2body.GetType()===box2d.b2BodyType.b2_staticBody&&this.b2body.SetType(box2d.b2BodyType.b2_dynamicBody),this.dynamic=isDynamic)},ItemEntity.prototype.setCollisionMask=function(maskBits){for(var fixture=this.b2body.GetFixtureList();null!=fixture;){var b2Filter=fixture.GetFilterData();b2Filter.maskBits=maskBits,fixture.SetFilterData(b2Filter),fixture=fixture.GetNext()}},ItemEntity.prototype.setBodyAngle=function(radian,toDegree){"undefined"==typeof toDegree&&(toDegree=!0),this.b2body&&(toDegree?this.b2body.SetTransformVecRadians(this.b2body.GetPosition(),steer.MathUtil.radian(radian)):this.b2body.SetTransformVecRadians(this.b2body.GetPosition(),radian))},ItemEntity.prototype.getBoundingBox=function(){if(this.b2body){var bodyAABB=new box2d.b2AABB;bodyAABB.lowerBound=new box2d.b2Vec2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),bodyAABB.upperBound=new box2d.b2Vec2(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var f=this.b2body.GetFixtureList();f;f=f.GetNext())for(var shape=f.GetShape(),c=0;c<shape.GetChildCount();c++)bodyAABB.Combine1(f.GetAABB(c));var tx=bodyAABB.lowerBound.x,ty=bodyAABB.lowerBound.y,tw=bodyAABB.upperBound.x-tx,th=bodyAABB.upperBound.y-ty;return{x:tx,y:ty,w:tw,h:th}}return null},ItemEntity.prototype.remove=function(){this.pixiDebugItem&&(this.pixiDebugItem.clear(),this.pixiDebugItem.stage.removeChild(this.pixiDebugItem),this.pixiDebugItem.parent.removeChild(this.pixiDebugItem),this.pixiDebugItem.removeStageReference(),this.pixiDebugItem=void 0),this.b2body&&(this.b2body.SetUserData(void 0),this.b2body.GetWorld().DestroyBody(this.b2body),this.b2body=void 0),this.threeDebugItem,this.domain=void 0},ItemEntity.NO_UNIT_COLLIDE=1,ItemEntity.DYNAMIC=2,ItemEntity.FILTER_UNIT=1,ItemEntity.FILTER_STATIC=2,ItemEntity}(ItemBase);_item.ItemEntity=ItemEntity;var ItemDatas=function(){function ItemDatas(){this.itemList=[],this.itemDict=[]}return ItemDatas.prototype.add=function(item){this.exist(item)||(this.itemDict[item.name]=item,this.itemList.push(item))},ItemDatas.prototype.getItem=function(name){return this.itemDict[name]},ItemDatas.prototype.remove=function(item){var target;if(target="string"==typeof item?this.itemDict[item]:item,this.exist(target)){delete this.itemDict[target.name];for(var itemLength=this.itemList.length;itemLength--;)if(this.itemList[itemLength]===target){this.itemList.splice(itemLength,1);break}}},ItemDatas.prototype.exist=function(item){return"string"==typeof item?null!=this.itemDict[item]:null!=this.itemDict[item.name]},ItemDatas.prototype.each=function(callBack,itemType){if(itemType){for(var itemTypeData=itemType.split(","),typeLen=itemTypeData.length;typeLen--;)itemTypeData[typeLen]=itemTypeData[typeLen].trim();for(var itemLength=this.itemList.length;itemLength--;)itemTypeData.indexOf(this.itemList[itemLength].type)>-1&&callBack(this.itemList[itemLength])}else for(var itemLength=this.itemList.length;itemLength--;)callBack(this.itemList[itemLength])},ItemDatas.prototype.getList=function(itemType){var result=[];if(itemType){for(var itemTypeData=itemType.split(","),typeLen=itemTypeData.length;typeLen--;)itemTypeData[typeLen]=itemTypeData[typeLen].trim();for(var itemLength=this.itemList.length;itemLength--;)itemTypeData.indexOf(this.itemList[itemLength].type)>-1&&result.push(this.itemList[itemLength])}else result=this.itemList.concat(result);return result},ItemDatas}();_item.ItemDatas=ItemDatas}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(item){var Circle=function(_super){function Circle(b2Body,radius,name){_super.call(this,b2Body,name),this.radius=radius,this.lastPosition=this.b2body.GetPosition().Clone(),this.lastRotation=this.b2body.GetAngle()}return __extends(Circle,_super),Circle}(item.ItemEntity);item.Circle=Circle}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(item){var Unit=function(_super){function Unit(b2Body,radius,maxSpeed,maxForce,name){"undefined"==typeof maxSpeed&&(maxSpeed=10),"undefined"==typeof maxForce&&(maxForce=1),_super.call(this,b2Body,radius,name),this.separateRadius=0,this.cohesionRadius=0,this.alignRadius=0,this.pathVelocityRatio=2,this.pathOnFrontRatio=2,this.pathAtIndex=0,this.pathSeekAheadAmt=1,this.loopOnPath=!1,this.rayFrontRatio=4,this.canCollide=!0,this.mass=1,this.maxSpeed=maxSpeed,this.maxForce=maxForce,this.velocity=new steer.Vector(0,0),this.acceleration=new steer.Vector(0,0),this.diffPosition=new box2d.b2Vec2(0,0),this.c_averageVelocity=new steer.Vector,this.separateRadius=this.radius+Unit.UnitSperateGap,this.cohesionRadius=this.alignRadius=this.radius,this.oldVelocities=[]}return __extends(Unit,_super),Unit.prototype.applyForce=function(force,mult){"undefined"==typeof mult&&(mult=1),1!=mult&&force.mult(mult),this.acceleration.add(force)},Unit.prototype.addAverageData=function(newOne){this.oldVelocities.length>2&&this.oldVelocities.shift(),this.oldVelocities.push(newOne)},Unit.prototype.averageVelocity=function(){return this.velocity.clone()},Unit.prototype.update=function(delta){if(!this.dynamic)return this.velocity.setTo(0,0),void this.acceleration.setTo(0,0);this.acceleration.div(this.mass).mult(delta);var oldVelocity=this.velocity.clone();this.addAverageData(this.velocity.clone()),this.velocity.add(this.acceleration).limit(this.maxSpeed);var averageVelocity=this.velocity.clone().add(oldVelocity).div(2);this.b2body.SetAwake(!0),this.b2body.SetLinearVelocity(averageVelocity.mult(delta).makeB2Vec()),this.acceleration.setTo(0,0)},Unit.prototype.getRaycast=function(useGlobal){"undefined"==typeof useGlobal&&(useGlobal=!1);var result=[],atx=this.getb2X(),aty=this.getb2Y(),avgVelocity=this.averageVelocity(),heading=avgVelocity.heading(),velocityLength=this.c_velocityLength,baseAngle=0,speedRatio=25*(1-avgVelocity.mag()/this.maxSpeed);baseAngle=Math.round(speedRatio+5);var angSideAdd=heading+90*steer.MathUtil.ONED,a1x=Math.cos(angSideAdd)*(this.radius+Unit.UnitSperateGap),a1y=Math.sin(angSideAdd)*(this.radius+Unit.UnitSperateGap),angAdd=heading+steer.MathUtil.ONED*baseAngle,a2x=Math.cos(angAdd)*velocityLength+a1x,a2y=Math.sin(angAdd)*velocityLength+a1y;useGlobal&&(a1x+=atx,a1y+=aty,a2x+=atx,a2y+=aty),result.push(new steer.Vector(a1x,a1y),new steer.Vector(a2x,a2y));var angSideSub=heading-90*steer.MathUtil.ONED,s1x=Math.cos(angSideSub)*(this.radius+Unit.UnitSperateGap),s1y=Math.sin(angSideSub)*(this.radius+Unit.UnitSperateGap),angSub=heading-steer.MathUtil.ONED*baseAngle,s2x=Math.cos(angSub)*velocityLength+s1x,s2y=Math.sin(angSub)*velocityLength+s1y;useGlobal&&(s1x+=atx,s1y+=aty,s2x+=atx,s2y+=aty),result.push(new steer.Vector(s1x,s1y),new steer.Vector(s2x,s2y));var c1x=Math.cos(heading)*(this.radius+Unit.UnitSperateGap),c1y=Math.sin(heading)*(this.radius+Unit.UnitSperateGap),c2x=Math.cos(heading)*(velocityLength-this.separateRadius)+c1x,c2y=Math.sin(heading)*(velocityLength-this.separateRadius)+c1y;return useGlobal&&(c1x+=atx,c1y+=aty,c2x+=atx,c2y+=aty),result.push(new steer.Vector(c1x,c1y),new steer.Vector(c2x,c2y)),result},Unit.prototype.setCanCollideOtherUnit=function(canCollide){this.canCollide=canCollide;{var fixture=this.b2body.GetFixtureList();fixture.GetFilterData()}this.b2body.DestroyFixture(fixture);var cirleShape=new box2d.b2CircleShape;cirleShape.m_radius=this.radius;var fixDef=item.Creator.createFixtureDef();fixDef.shape=cirleShape,fixDef.filter.categoryBits=item.ItemEntity.FILTER_UNIT,fixDef.filter.maskBits=item.ItemEntity.FILTER_STATIC|item.ItemEntity.FILTER_UNIT,canCollide||(fixDef.filter.maskBits=item.ItemEntity.FILTER_STATIC),this.b2body.CreateFixture(fixDef)},Unit.prototype.prepareUpdateCache=function(){var avgVelocity=this.averageVelocity();this.currentRayFront=avgVelocity.mag()*this.rayFrontRatio+this.separateRadius;var minLength=this.separateRadius,velocityLength=this.currentRayFront;minLength>velocityLength&&(velocityLength=minLength),this.c_velocityLength=velocityLength,this.c_rayInfo=this.getRaycast(!0),this.avoidInfo={}},Unit.prototype.setb2Position=function(x,y){this.b2body.SetPosition(new box2d.b2Vec2(x,y))},Unit.prototype.setSteerPosition=function(x,y){this.b2body.SetPosition(new box2d.b2Vec2(x/30,y/30))},Unit.prototype.getBoundingBox=function(){if(this.b2body){var bodyAABB=new box2d.b2AABB;bodyAABB.lowerBound=new box2d.b2Vec2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),bodyAABB.upperBound=new box2d.b2Vec2(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var f=this.b2body.GetFixtureList();f;f=f.GetNext())for(var shape=f.GetShape(),c=0;c<shape.GetChildCount();c++)bodyAABB.Combine1(f.GetAABB(c));var rayInfo=this.c_rayInfo,maxRadius=Math.max(this.separateRadius,this.cohesionRadius,this.alignRadius),lowerV=new box2d.b2Vec2(this.getb2X()-maxRadius,this.getb2Y()-maxRadius),upperV=new box2d.b2Vec2(this.getb2X()+maxRadius,this.getb2Y()+maxRadius);if(bodyAABB.Combine1({lowerBound:lowerV,upperBound:upperV}),this.averageVelocity().mag()>0)for(var s=0;s<rayInfo.length;s+=2)bodyAABB.Combine1({lowerBound:rayInfo[s],upperBound:rayInfo[s+1]}),bodyAABB.Combine1({lowerBound:rayInfo[s+1],upperBound:rayInfo[s]});var tx=bodyAABB.lowerBound.x,ty=bodyAABB.lowerBound.y,tw=bodyAABB.upperBound.x-tx,th=bodyAABB.upperBound.y-ty;return{x:tx,y:ty,w:tw,h:th}}return null},Unit.prototype.resetVelocity=function(){this.oldVelocities=[],this.velocity.setTo(0,0),this.acceleration.setTo(0,0),this.b2body.SetLinearVelocity(new box2d.b2Vec2(0,0)),this.updateBeforeStep()},Unit.UnitSperateGap=.1,Unit}(item.Circle);item.Unit=Unit}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(item){var Polygon=function(_super){function Polygon(b2Body,name){_super.call(this,b2Body,name),this.shapes=[],this.shapeLen=0;for(var fixture=b2Body.GetFixtureList();null!=fixture;)fixture.GetType()==box2d.b2ShapeType.e_polygonShape&&(this.shapes.push(fixture.GetShape()),this.shapeLen++),fixture=fixture.GetNext();this.lastPosition=this.b2body.GetPosition().Clone(),this.lastRotation=this.b2body.GetAngle()}return __extends(Polygon,_super),Polygon}(item.ItemEntity);item.Polygon=Polygon}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(item){var Edge=function(_super){function Edge(b2Body,name){_super.call(this,b2Body,name);var fixture=b2Body.GetFixtureList();for(this.shapes=[],this.shapeLen=0;null!=fixture;){var shape=fixture.GetShape();shape.m_type==box2d.b2ShapeType.e_edgeShape&&(this.shapes.push(shape),this.shapeLen++),fixture=fixture.GetNext()}this.lastPosition=this.b2body.GetPosition().Clone(),this.lastRotation=this.b2body.GetAngle()}return __extends(Edge,_super),Edge}(item.ItemEntity);item.Edge=Edge}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(item){var PathInfo=function(){function PathInfo(startPt,pathWidth,interpolateSize){"undefined"==typeof interpolateSize&&(interpolateSize=10),this.startPt=startPt,this.pathWidth=pathWidth,this.interpolateSize=interpolateSize,this.reset()}return PathInfo.fillSVGPathElement=function(path,pathInfo){PathInfo.svgConvertToAbsolute(path);var data=steer.item.PathInfo.parseSVG(path.getAttribute("d"));pathInfo.reset();for(var sx=pathInfo.startPt.x,sy=pathInfo.startPt.y,s=0;s<data.length;s++)switch(data[s][0]){case"L":case"l":pathInfo.lineTo(data[s][1]+sx,data[s][2]+sy);break;case"M":case"m":pathInfo.startPt=new steer.Vector(data[s][1]+sx,data[s][2]+sy);break;case"C":case"c":pathInfo.curveTo(data[s][1]+sx,data[s][2]+sy,data[s][3]+sx,data[s][4]+sy,data[s][5]+sx,data[s][6]+sy);break;case"S":case"s":pathInfo.curveTo(data[s-1][5]+sx,data[s-1][6]+sy,data[s][1]+sx,data[s][2]+sy,data[s][3]+sx,data[s][4]+sy)}return pathInfo},PathInfo.parseSVG=function(path){var data=[],svgObjLen={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},svgSegment=/([astvzqmhlc])([^astvzqmhlc]*)/gi;return path.replace(svgSegment,function(_,command,args){var type=command.toLowerCase();for(args=PathInfo.parseSvgEntry(args),"m"==type&&args.length>2&&(data.push([command].concat(args.splice(0,2))),type="l",command="m"==command?"l":"L");;){if(args.length==svgObjLen[type])return args.unshift(command),data.push(args);if(args.length<svgObjLen[type])throw new Error("malformed path data");data.push([command].concat(args.splice(0,svgObjLen[type])))}}),data},PathInfo.parseSvgEntry=function(args){return args=args.match(/-?[.0-9]+(?:e[-+]?\d+)?/gi),args?args.map(Number):[]},PathInfo.svgConvertToAbsolute=function(path){for(var x0,y0,x1,y1,x2,y2,segs=path.pathSegList,x=0,y=0,i=0,len=segs.numberOfItems;len>i;++i){var seg=segs.getItem(i),c=seg.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(c))"x"in seg&&(x=seg.x),"y"in seg&&(y=seg.y);else switch("x1"in seg&&(x1=x+seg.x1),"x2"in seg&&(x2=x+seg.x2),"y1"in seg&&(y1=y+seg.y1),"y2"in seg&&(y2=y+seg.y2),"x"in seg&&(x+=seg.x),"y"in seg&&(y+=seg.y),c){case"m":segs.replaceItem(path.createSVGPathSegMovetoAbs(x,y),i);break;case"l":segs.replaceItem(path.createSVGPathSegLinetoAbs(x,y),i);break;case"h":segs.replaceItem(path.createSVGPathSegLinetoHorizontalAbs(x),i);break;case"v":segs.replaceItem(path.createSVGPathSegLinetoVerticalAbs(y),i);break;case"c":segs.replaceItem(path.createSVGPathSegCurvetoCubicAbs(x,y,x1,y1,x2,y2),i);break;case"s":segs.replaceItem(path.createSVGPathSegCurvetoCubicSmoothAbs(x,y,x2,y2),i);break;case"q":segs.replaceItem(path.createSVGPathSegCurvetoQuadraticAbs(x,y,x1,y1),i);break;case"t":segs.replaceItem(path.createSVGPathSegCurvetoQuadraticSmoothAbs(x,y),i);break;case"a":segs.replaceItem(path.createSVGPathSegArcAbs(x,y,seg.r1,seg.r2,seg.angle,seg.largeArcFlag,seg.sweepFlag),i);break;case"z":case"Z":x=x0,y=y0}("M"==c||"m"==c)&&(x0=x,y0=y)}},PathInfo.interpolate=function(percent,start,cp1,cp2,end){function B1(t){return t*t*t}function B2(t){return 3*t*t*(1-t)}function B3(t){return 3*t*(1-t)*(1-t)}function B4(t){return(1-t)*(1-t)*(1-t)}var pos=new steer.Vector;return pos.x=start.x*B1(percent)+cp1.x*B2(percent)+cp2.x*B3(percent)+end.x*B4(percent),pos.y=start.y*B1(percent)+cp1.y*B2(percent)+cp2.y*B3(percent)+end.y*B4(percent),pos},PathInfo.createPath=function(pathInfo,div30){"undefined"==typeof div30&&(div30=!1);for(var copySegs=[],copyDraws=[],s=0;s<pathInfo.segments.length;s++){var newSeg=new steer.Vector(pathInfo.segments[s].x,pathInfo.segments[s].y);copySegs.push(div30?newSeg.div(30):newSeg)}for(var k=0;k<pathInfo.drawInfo.length;k++){var copy=pathInfo.drawInfo[k],pdi=new PathDrawInfo(new steer.Vector(copy.start.x,copy.start.y),new steer.Vector(copy.end.x,copy.end.y),copy.type);copy.cp1&&pdi.setControlPt(new steer.Vector(copy.cp1.x,copy.cp1.y),new steer.Vector(copy.cp2.x,copy.cp2.y)),div30&&(pdi.start.div(30),pdi.end.div(30),pdi.cp1&&(pdi.cp1.div(30),pdi.cp2.div(30))),copyDraws.push(pdi)}return new Path(div30?pathInfo.pathWidth/30:pathInfo.pathWidth,copySegs,copyDraws)},PathInfo.prototype.curveTo=function(cp1x,cp1y,cp2x,cp2y,tox,toy){0==this.segments.length&&this.segments.push(this.startPt.clone());for(var startPt=this.segments[this.segments.length-1],addSegs=[],k=this.interpolateSize-1;k>-1;k--){var pt=PathInfo.interpolate(k/(this.interpolateSize-1),startPt,new steer.Vector(cp1x,cp1y),new steer.Vector(cp2x,cp2y),new steer.Vector(tox,toy));addSegs.push(pt)}this.segments.length>=2&&addSegs.shift(),this.segments=this.segments.concat(addSegs);var drawinfo=new PathDrawInfo(startPt.clone(),new steer.Vector(tox,toy),PathDrawInfo.TYPE_BEZIER);return drawinfo.setControlPt(new steer.Vector(cp1x,cp1y),new steer.Vector(cp2x,cp2y)),this.drawInfo.push(drawinfo),this},PathInfo.prototype.lineInterpolate=function(start,end){for(var xdiff=(Math.abs(start.x-end.x),Math.abs(start.y-end.y),end.x-start.x),ydiff=end.y-start.y,length=steer.Vector.distance(end,start),intSize=Math.floor(length/200),xrate=xdiff/intSize,yrate=ydiff/intSize,s=0;intSize>s;s++){var addVec=new steer.Vector(start.x+xrate*s,start.y+yrate*s);this.segments.push(addVec)}this.segments.push(end)},PathInfo.prototype.lineTo=function(tox,toy){0==this.segments.length&&this.segments.push(this.startPt.clone());var startPt=this.segments[this.segments.length-1];this.lineInterpolate(startPt,new steer.Vector(tox,toy));var drawinfo=new PathDrawInfo(startPt.clone(),new steer.Vector(tox,toy),PathDrawInfo.TYPE_LINE);return this.drawInfo.push(drawinfo),this},PathInfo.prototype.reset=function(){this.segments=[],this.drawInfo=[]},PathInfo}();item.PathInfo=PathInfo;var PathDrawInfo=function(){function PathDrawInfo(start,end,type){this.start=start,this.end=end,this.type=type}return PathDrawInfo.prototype.setControlPt=function(cp1,cp2){this.cp1=cp1,this.cp2=cp2},PathDrawInfo.prototype.clone=function(div30){var newOne=new PathDrawInfo(this.start.clone(),this.end.clone(),this.type);return div30&&(newOne.start.div(30),newOne.end.div(30)),this.type==PathDrawInfo.TYPE_BEZIER&&(newOne.setControlPt(this.cp1.clone(),this.cp2.clone()),div30&&(newOne.cp1.div(30),newOne.cp2.div(30))),newOne},PathDrawInfo.TYPE_LINE=0,PathDrawInfo.TYPE_BEZIER=1,PathDrawInfo}();item.PathDrawInfo=PathDrawInfo;var Path=function(_super){function Path(pathWidth,segments,drawInfo){_super.call(this,null),this.segments=segments,this.drawInfo=drawInfo,this.pathWidth=pathWidth}return __extends(Path,_super),Path.prototype.remove=function(){this.pixiDebugItem&&this.pixiDebugItem.parent&&(this.pixiDebugItem.parent.removeChild(this.pixiDebugItem),this.pixiDebugItem.removeStageReference(),this.pixiDebugItem=null),this.domain=null},Path}(item.ItemBase);item.Path=Path}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(item){var Sensor=function(_super){function Sensor(b2Body,name){_super.call(this,b2Body,name),this.overLapItems=[],this.shapes=[],this.shapeLen=0;for(var fixture=b2Body.GetFixtureList();null!=fixture;)fixture.GetType()==box2d.b2ShapeType.e_polygonShape&&(this.shapes.push(fixture.GetShape()),this.shapeLen++),fixture=fixture.GetNext();this.lastPosition=this.b2body.GetPosition().Clone(),this.lastRotation=this.b2body.GetAngle(),this.overLapItems=[]}return __extends(Sensor,_super),Sensor.prototype.asForcePushVector=function(force){this.forceType=Sensor.FORCE_PUSH_VECTOR,this.pushForce=force.clone().mult(.01),this.forceAngle=this.pushForce.heading()},Sensor.prototype.asForcePushCenter=function(forceMagnitude){this.forceType=Sensor.FORCE_PUSH_CENTER,this.forceMagnitude=.01*forceMagnitude},Sensor.prototype.asForcePullCenter=function(forceMagnitude){this.forceType=Sensor.FORCE_PULL_CENTER,this.forceMagnitude=.01*forceMagnitude},Sensor.prototype.asEventSensor=function(eventStart,eventEnd){this.eventStart=eventStart,this.eventEnd=eventEnd},Sensor.prototype.update=function(){this.overLapItems.length;for(var key in this.overLapItems){var unit=this.overLapItems[key];switch(this.forceType){case Sensor.FORCE_PUSH_VECTOR:unit.applyForce(steer.Vector.fromAngle(this.pushForce.heading()+this.b2body.GetAngle(),this.pushForce.mag()));break;case Sensor.FORCE_PUSH_CENTER:var angleVec=steer.Vector.sub(unit.getb2Position(),this.getb2Position());angleVec.normalizeThanMult(this.forceMagnitude),unit.applyForce(angleVec);break;case Sensor.FORCE_PULL_CENTER:var angleVec=steer.Vector.sub(this.getb2Position(),unit.getb2Position());unit.applyForce(angleVec.normalizeThanMult(this.forceMagnitude))}}},Sensor.FORCE_PUSH_VECTOR=1,Sensor.FORCE_PUSH_CENTER=2,Sensor.FORCE_PULL_CENTER=3,Sensor.SHAPE_BOX=1,Sensor.SHAPE_CIRCLE=2,Sensor}(item.ItemEntity);item.Sensor=Sensor}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(item){var Creator=function(){function Creator(){}return Creator.cloneObject=function(source){if("[object Array]"===Object.prototype.toString.call(source)){for(var clone=[],i=0;i<source.length;i++)clone[i]=Creator.cloneObject(source[i]);
return clone}if("object"==typeof source){var clone={};for(var prop in source)source.hasOwnProperty(prop)&&(clone[prop]=Creator.cloneObject(source[prop]));return clone}return source},Creator.setDomainReference=function(domain){Creator.domain=domain},Creator.createInfoCheckDefault=function(createInfo){var copyInfo=Creator.cloneObject(createInfo);if(null==copyInfo.x&&(copyInfo.x=0),null==copyInfo.y&&(copyInfo.y=0),null==copyInfo.dynamic&&(copyInfo.dynamic=!1),Creator.pixelCreateFormat&&(copyInfo.x&&(copyInfo.x/=30),copyInfo.y&&(copyInfo.y/=30),copyInfo.radius&&(copyInfo.radius/=30),copyInfo.widthHalf&&(copyInfo.widthHalf/=30),copyInfo.heightHalf&&(copyInfo.heightHalf/=30),copyInfo.maxSpeed&&(copyInfo.maxSpeed/=30),copyInfo.maxForce&&(copyInfo.maxForce/=30),copyInfo.blockSize&&(copyInfo.blockSize=new steer.Vector(copyInfo.blockSize.x/30,copyInfo.blockSize.y/30))),createInfo.vertices){copyInfo.vertices=[];for(var ptLen=createInfo.vertices.length,k=0;ptLen>k;k++)copyInfo.vertices.push(Creator.pixelCreateFormat?new box2d.b2Vec2(createInfo.vertices[k].x/30,createInfo.vertices[k].y/30):new box2d.b2Vec2(createInfo.vertices[k].x,createInfo.vertices[k].y))}return copyInfo},Creator.createFixtureDef=function(){var fixDef=new box2d.b2FixtureDef;return fixDef.density=1,fixDef.friction=0,fixDef.restitution=0,fixDef},Creator.createCircle=function(createInfo){!Creator.domain;var cinfo=Creator.createInfoCheckDefault(createInfo);null==cinfo.radius;var ballDef=new box2d.b2BodyDef;ballDef.type=box2d.b2BodyType.b2_staticBody,ballDef.linearDamping=1e3,ballDef.angularDamping=1e3,cinfo.dynamic&&(ballDef.type=box2d.b2BodyType.b2_dynamicBody),ballDef.position.SetXY(cinfo.x,cinfo.y);var b2BodyNew=Creator.domain.b2World.CreateBody(ballDef),cirleShape=new box2d.b2CircleShape;cirleShape.m_radius=cinfo.radius;var fixDef=Creator.createFixtureDef();fixDef.filter.categoryBits=item.ItemEntity.FILTER_STATIC|item.ItemEntity.FILTER_UNIT,fixDef.shape=cirleShape,b2BodyNew.CreateFixture(fixDef);var newCircle=new item.Circle(b2BodyNew,cinfo.radius,cinfo.name);return newCircle.domain=Creator.domain,newCircle.dynamic=1==cinfo.dynamic,b2BodyNew.SetUserData({name:newCircle.name,entity:newCircle}),Creator.domain.items.add(newCircle),newCircle},Creator.createUnit=function(createInfo){!Creator.domain;var cinfo=Creator.createInfoCheckDefault(createInfo);null==cinfo.radius,null==cinfo.maxSpeed,null==cinfo.maxForce;var ballDef=new box2d.b2BodyDef;ballDef.type=box2d.b2BodyType.b2_dynamicBody,ballDef.linearDamping=0,ballDef.angularDamping=0,0==cinfo.dynamic&&(ballDef.type=box2d.b2BodyType.b2_staticBody),ballDef.position.SetXY(cinfo.x,cinfo.y),ballDef.fixedRotation=!0;var b2BodyNew=Creator.domain.b2World.CreateBody(ballDef),cirleShape=new box2d.b2CircleShape;cirleShape.m_radius=cinfo.radius;var fixDef=Creator.createFixtureDef();fixDef.shape=cirleShape,fixDef.filter.categoryBits=item.ItemEntity.FILTER_UNIT,0==createInfo.canCollide&&(fixDef.filter.maskBits=item.ItemEntity.FILTER_STATIC),b2BodyNew.CreateFixture(fixDef),b2BodyNew.SetBullet(!0);var newUnit=new item.Unit(b2BodyNew,cinfo.radius,cinfo.maxSpeed,cinfo.maxForce,cinfo.name);return newUnit.domain=Creator.domain,newUnit.dynamic=1==cinfo.dynamic,b2BodyNew.SetUserData({name:newUnit.name,entity:newUnit}),Creator.domain.items.add(newUnit),newUnit},Creator.createPolygon=function(createInfo){!Creator.domain;var cinfo=Creator.createInfoCheckDefault(createInfo);null==cinfo.dynamic&&(cinfo.dynamic=!1);var boxDef=new box2d.b2BodyDef;boxDef.type=box2d.b2BodyType.b2_staticBody,boxDef.linearDamping=1e3,boxDef.angularDamping=1e3,cinfo.dynamic&&(boxDef.type=box2d.b2BodyType.b2_dynamicBody);var polygonShape=new box2d.b2PolygonShape;if(cinfo.asBoxCenter){null==cinfo.widthHalf,null==cinfo.heightHalf;var xto=cinfo.asBoxTopLeft?cinfo.x+cinfo.widthHalf:cinfo.x,yto=cinfo.asBoxTopLeft?cinfo.y+cinfo.heightHalf:cinfo.y;boxDef.position.SetXY(xto,yto);var b2BodyNew=Creator.domain.b2World.CreateBody(boxDef);polygonShape.SetAsBox(cinfo.widthHalf,cinfo.heightHalf)}if(cinfo.asPolygon){null==cinfo.vertices||cinfo.vertices.length<3,boxDef.position.SetXY(cinfo.x,cinfo.y);var b2BodyNew=Creator.domain.b2World.CreateBody(boxDef);polygonShape.Set(cinfo.vertices,cinfo.vertices.length)}var fixDef=Creator.createFixtureDef();fixDef.filter.categoryBits=item.ItemEntity.FILTER_STATIC|item.ItemEntity.FILTER_UNIT,fixDef.shape=polygonShape,b2BodyNew.CreateFixture(fixDef);var newPolygon=new item.Polygon(b2BodyNew,cinfo.name);return newPolygon.dynamic=1==cinfo.dynamic,b2BodyNew.SetUserData({name:newPolygon.name,entity:newPolygon}),Creator.domain.items.add(newPolygon),newPolygon},Creator.createPolygonBorder=function(createInfo){!Creator.domain;var cinfo=Creator.createInfoCheckDefault(createInfo);if(cinfo.asPolygonBorder){null==cinfo.polygonBorderWidth||null==cinfo.polygonBorderTL||null==cinfo.polygonBorderBR;var b=cinfo.polygonBorderWidth,halfb=.5*cinfo.polygonBorderWidth,sx=cinfo.polygonBorderTL.x,sy=cinfo.polygonBorderTL.y,ex=cinfo.polygonBorderBR.x,ey=cinfo.polygonBorderBR.y,w=.5*(ex-sx),h=.5*(ey-sy);if(cinfo.polygonBorderInside){var topInfo={x:sx,y:sy,widthHalf:w,heightHalf:halfb,asBoxCenter:!0,asBoxTopLeft:!0,properties:~item.ItemEntity.DYNAMIC},topPolygon=steer.item.Creator.createPolygon(topInfo),btmInfo={x:sx,y:ey-b,widthHalf:w,heightHalf:halfb,asBoxCenter:!0,asBoxTopLeft:!0,properties:~item.ItemEntity.DYNAMIC},bottomPolygon=steer.item.Creator.createPolygon(btmInfo),leftInfo={x:sx,y:sy+b,widthHalf:halfb,heightHalf:h-b,asBoxCenter:!0,asBoxTopLeft:!0,properties:~item.ItemEntity.DYNAMIC},leftPolygon=steer.item.Creator.createPolygon(leftInfo),rightInfo={x:ex-b,y:sy+b,widthHalf:halfb,heightHalf:h-b,asBoxCenter:!0,asBoxTopLeft:!0,properties:~item.ItemEntity.DYNAMIC},rightPolygon=steer.item.Creator.createPolygon(rightInfo);return[topPolygon,rightPolygon,bottomPolygon,leftPolygon]}var topInfo={x:sx-b,y:sy-b,widthHalf:w+b,heightHalf:halfb,asBoxCenter:!0,asBoxTopLeft:!0,properties:~item.ItemEntity.DYNAMIC},topPolygon=steer.item.Creator.createPolygon(topInfo),btmInfo={x:sx-b,y:ey,widthHalf:w+b,heightHalf:halfb,asBoxCenter:!0,asBoxTopLeft:!0,properties:~item.ItemEntity.DYNAMIC},bottomPolygon=steer.item.Creator.createPolygon(btmInfo),leftInfo={x:sx-b,y:sy,widthHalf:halfb,heightHalf:h,asBoxCenter:!0,asBoxTopLeft:!0,properties:~item.ItemEntity.DYNAMIC},leftPolygon=steer.item.Creator.createPolygon(leftInfo),rightInfo={x:ex,y:sy,widthHalf:halfb,heightHalf:h,asBoxCenter:!0,asBoxTopLeft:!0,properties:~item.ItemEntity.DYNAMIC},rightPolygon=steer.item.Creator.createPolygon(rightInfo);return[topPolygon,rightPolygon,bottomPolygon,leftPolygon]}},Creator.createEdge=function(createInfo){!Creator.domain;var cinfo=Creator.createInfoCheckDefault(createInfo);cinfo.dynamic=!1;var bodyDef=new box2d.b2BodyDef;bodyDef.type=box2d.b2BodyType.b2_staticBody,bodyDef.position.SetXY(cinfo.x,cinfo.y),bodyDef.linearDamping=0,bodyDef.angularDamping=0;var b2BodyNew=Creator.domain.b2World.CreateBody(bodyDef),fixDef=Creator.createFixtureDef(),edgeShape=new box2d.b2EdgeShape;fixDef.shape=edgeShape,fixDef.filter.categoryBits=item.ItemEntity.FILTER_STATIC|item.ItemEntity.FILTER_UNIT;for(var k=0;k+1<cinfo.vertices.length;k++)edgeShape.Set(cinfo.vertices[k],cinfo.vertices[k+1]),b2BodyNew.CreateFixture(fixDef);var newEdge=new item.Edge(b2BodyNew,cinfo.name);return newEdge.domain=Creator.domain,newEdge.dynamic=!1,b2BodyNew.SetUserData({name:newEdge.name,entity:newEdge}),Creator.domain.items.add(newEdge),newEdge},Creator.createSensorArea=function(createInfo){!Creator.domain;var cinfo=Creator.createInfoCheckDefault(createInfo),bodyDef=new box2d.b2BodyDef;bodyDef.type=box2d.b2BodyType.b2_staticBody;var fixDef=Creator.createFixtureDef();if(fixDef.isSensor=!0,cinfo.asCircle){null==cinfo.radius,bodyDef.position.SetXY(cinfo.x,cinfo.y);var b2Body=Creator.domain.b2World.CreateBody(bodyDef),cirleShape=new box2d.b2CircleShape;cirleShape.m_radius=cinfo.radius,fixDef.shape=cirleShape}if(cinfo.asBoxCenter){null==cinfo.heightHalf||null==cinfo.widthHalf;var xto=cinfo.asBoxTopLeft?cinfo.x+cinfo.widthHalf:cinfo.x,yto=cinfo.asBoxTopLeft?cinfo.y+cinfo.heightHalf:cinfo.y;bodyDef.position.SetXY(xto,yto);var b2Body=Creator.domain.b2World.CreateBody(bodyDef),polygonShape=new box2d.b2PolygonShape;polygonShape.SetAsBox(cinfo.widthHalf,cinfo.heightHalf),fixDef.shape=polygonShape}b2Body.CreateFixture(fixDef);var newSensor=new item.Sensor(b2Body,cinfo.name);return cinfo.asBoxCenter?newSensor.shapeType=item.Sensor.SHAPE_BOX:(newSensor.shapeType=item.Sensor.SHAPE_CIRCLE,newSensor.radius=cinfo.radius),newSensor.dynamic=cinfo.dynamic,newSensor.shapeType=cinfo.asBoxCenter?item.Sensor.SHAPE_BOX:item.Sensor.SHAPE_CIRCLE,b2Body.SetUserData({name:newSensor.name,entity:newSensor}),Creator.domain.autoItems.add(newSensor),newSensor},Creator.createGridmap=function(createInfo){!Creator.domain;var cinfo=Creator.createInfoCheckDefault(createInfo),errors=Creator.checkRequireInfos(createInfo,"x,y,blockSize,gridSize");if(!(errors.length>0)){var gridmap=new item.GridMap(cinfo.x,cinfo.y,cinfo.blockSize,cinfo.gridSize,cinfo.name);return Creator.domain.gridMaps.add(gridmap),gridmap}},Creator.createPath=function(createInfo){!Creator.domain;var cinfo=Creator.createInfoCheckDefault(createInfo),errors=Creator.checkRequireInfos(createInfo,"pathInfo");if(!(errors.length>0)){var path=item.PathInfo.createPath(cinfo.pathInfo,Creator.pixelCreateFormat);return Creator.domain.items.add(path),path}},Creator.checkRequireInfos=function(createInfo,list){for(var lists=list.split(","),len=lists.length,errors=[],s=0;len>s;s++)null==createInfo[lists[s]]&&errors.push(lists[s]);return errors},Creator.pixelCreateFormat=!0,Creator}();item.Creator=Creator}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(_item){var QuadNode=function(){function QuadNode(x,y,w,h,depth,maxChildren,maxDepth){"undefined"==typeof maxChildren&&(maxChildren=3),"undefined"==typeof maxDepth&&(maxDepth=4),this.items=[],this.nodes=[],this.x=x,this.y=y,this.width=w,this.height=h,this.depth=depth,this.maxChildren=maxChildren,this.maxDepth=maxDepth}return QuadNode.prototype.retrieve=function(selector,callback,instance){for(var _this=this,itemsLen=this.items.length,i=0;itemsLen>i;++i)instance?callback.call(instance,this.items[i]):callback(this.items[i]);this.nodes.length&&this.findOverlappingNodes(selector,function(dir){_this.nodes[dir].retrieve(selector,callback,instance)})},QuadNode.prototype.findOverlappingNodes=function(item,callback){item.x<this.x+this.width/2&&(item.y<this.y+this.height/2&&callback(QuadNode.TOP_LEFT),item.y+item.height>=this.y+this.height/2&&callback(QuadNode.BOTTOM_LEFT)),item.x+item.width>=this.x+this.width/2&&(item.y<this.y+this.height/2&&callback(QuadNode.TOP_RIGHT),item.y+item.height>=this.y+this.height/2&&callback(QuadNode.BOTTOM_RIGHT))},QuadNode.prototype.findInsertNode=function(item){return item.x+item.width<this.x+this.width/2?item.y+item.height<this.y+this.height/2?QuadNode.TOP_LEFT:item.y>=this.y+this.height/2?QuadNode.BOTTOM_LEFT:QuadNode.PARENT:item.x>=this.x+this.width/2?item.y+item.height<this.y+this.height/2?QuadNode.TOP_RIGHT:item.y>=this.y+this.height/2?QuadNode.BOTTOM_RIGHT:QuadNode.PARENT:QuadNode.PARENT},QuadNode.prototype.insert=function(item){var i;this.nodes.length>0?(i=this.findInsertNode(item),i===QuadNode.PARENT?this.items.push(item):this.nodes[i].insert(item)):(this.items.push(item),this.items.length>this.maxChildren&&this.depth<this.maxDepth&&this.divide())},QuadNode.prototype.divide=function(){var tw,th,i,oldChildren,childrenDepth=this.depth+1;for(tw=this.width/2,th=this.height/2,this.nodes.push(new QuadNode(this.x,this.y,tw,th,childrenDepth,this.maxChildren,this.maxDepth)),this.nodes.push(new QuadNode(this.x+tw,this.y,tw,th,childrenDepth,this.maxChildren,this.maxDepth)),this.nodes.push(new QuadNode(this.x,this.y+th,tw,th,childrenDepth,this.maxChildren,this.maxDepth)),this.nodes.push(new QuadNode(this.x+tw,this.y+th,tw,th,childrenDepth,this.maxChildren,this.maxDepth)),oldChildren=this.items,this.items=[],i=0;i<oldChildren.length;i++)this.insert(oldChildren[i])},QuadNode.prototype.clear=function(){for(var nodeLen=this.nodes.length;nodeLen--;)this.nodes[nodeLen].clear();this.items=[],this.nodes=[]},QuadNode.TOP_LEFT=0,QuadNode.TOP_RIGHT=1,QuadNode.BOTTOM_LEFT=2,QuadNode.BOTTOM_RIGHT=3,QuadNode.PARENT=4,QuadNode}();_item.QuadNode=QuadNode;var QuadSelector=function(){function QuadSelector(x,y,width,height,data){this.x=x,this.y=y,this.width=width,this.height=height,this.data=data}return QuadSelector.prototype.toString=function(){return"x:"+this.x+" y:"+this.y+" w: "+this.width+" h: "+this.height},QuadSelector}();_item.QuadSelector=QuadSelector;var QuadTree=function(){function QuadTree(x,y,w,h,maxChildren,maxDepth){"undefined"==typeof maxChildren&&(maxChildren=3),"undefined"==typeof maxDepth&&(maxDepth=4),this.drawDebug=!1,this.rootNode=new QuadNode(x,y,w,h,0,maxChildren,maxDepth)}return QuadTree.prototype.insert=function(item){this.rootNode.insert(item)},QuadTree.prototype.retrieve=function(selector,callback,instance){return this.rootNode.retrieve(selector,callback,instance)},QuadTree.prototype.clear=function(){this.rootNode.clear()},QuadTree.prototype.getItemSelector=function(itemIn){var result;if(null!=itemIn.b2body){var item=itemIn,bbox=item.getBoundingBox();result=new QuadSelector(bbox.x,bbox.y,bbox.w,bbox.h,itemIn)}return result},QuadTree.prototype.quadTreeSelect=function(item,optimizeDist){"undefined"==typeof optimizeDist&&(optimizeDist=!1);var result=[],selector=this.getItemSelector(item);if(selector){if(optimizeDist)var bbox=item.getBoundingBox(),bp=new steer.Vector(bbox.x+.5*bbox.w,bbox.y+.5*bbox.h),blen=2*(bbox.w+bbox.h);this.retrieve(selector,function(itemFound){if(itemFound.data!=item)if(optimizeDist){var cx=itemFound.x+.5*itemFound.width,cy=itemFound.y+.5*itemFound.height;steer.Vector.distanceSq(bp,new steer.Vector(cx,cy))<blen*blen&&(steer.render.PixiDebugRenderer.instance.drawDot(new steer.Vector(cx,cy),16724991,.1,1),result.push(itemFound))}else result.push(itemFound)})}return result.length>0?result:null},QuadTree}();_item.QuadTree=QuadTree}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){!function(item){var GridMap=function(_super){function GridMap(x,y,blockSize,gridSize,name){_super.call(this,name),this.x=x,this.y=y,this.blockSize=blockSize,this.gridSize=gridSize,this.w=this.blockSize.x*this.gridSize.x,this.h=this.blockSize.y*this.gridSize.y}return __extends(GridMap,_super),GridMap.prototype.remove=function(){this.pixiDebugItem&&(this.pixiDebugItem.clear(),this.pixiDebugItem.stage.removeChild(this.pixiDebugItem),this.pixiDebugItem.parent.removeChild(this.pixiDebugItem),this.pixiDebugItem.removeStageReference(),this.pixiDebugItem=void 0),this.domain=null},GridMap.prototype.toCenter=function(x,y){var xto=30*this.blockSize.x*x+15*this.blockSize.x,yto=30*this.blockSize.y*y+15*this.blockSize.y;return new steer.Vector(xto,yto)},GridMap.prototype.clearPathGrid=function(){if(this.pathData)for(var lx=0;lx<this.gridSize.x;lx++)for(var ly=0;ly<this.gridSize.y;ly++)this.pathData.setWalkableAt(lx,ly,!0)},GridMap.prototype.findPath=function(startx,starty,endx,endy,pathWidth,integrateSize){var finder=new PF.JumpPointFinder({allowDiagonal:!1,heuristic:PF.Heuristic.chebyshev}),path=finder.findPath(startx,starty,endx,endy,this.pathData.clone());path=PF.Util.compressPath(path);for(var startLoc=this.toCenter(startx,starty),pathInfo=(this.toCenter(endx,endy),new steer.item.PathInfo(startLoc,pathWidth,integrateSize)),s=1;s<path.length;s++){var loopLoc=this.toCenter(path[s][0],path[s][1]);pathInfo.lineTo(loopLoc.x,loopLoc.y)}return pathInfo},GridMap}(item.ItemBase);item.GridMap=GridMap}(steer.item||(steer.item={}));steer.item}(steer||(steer={}));var steer;!function(steer){var BaseRender=function(){function BaseRender(domain,w,h){this.domain=domain,this.w=w,this.h=h}return BaseRender.prototype.preDomainUpdate=function(){},BaseRender.prototype.domainUpdate=function(){},BaseRender.prototype.integrate=function(delta){var _this=this;this.domain.items.each(function(item){_this.itemRender(item,delta)}),this.domain.autoItems.each(function(item){_this.itemRender(item,delta)}),this.visualRender(delta)},BaseRender.prototype.itemRender=function(item,delta){var xto,yto,rto=0;item.b2body&&(xto=item.getb2X(),yto=item.getb2Y(),rto=item.b2body.GetAngle()),item.dynamic&&(xto=item.getb2X()+item.diffPosition.x*delta,yto=item.getb2Y()+item.diffPosition.y*delta,rto=item.b2body.GetAngle()+item.diffRotation*delta),this.updateObject&&this.updateObject.updateItem(item,xto,yto,rto,delta)},BaseRender.prototype.visualRender=function(delta){this.updateObject&&this.updateObject.updateStep(delta)},BaseRender}();steer.BaseRender=BaseRender;var Domain=function(){function Domain(){this.items=new steer.item.ItemDatas,this.autoItems=new steer.item.ItemDatas,this.gridMaps=new steer.item.ItemDatas,box2d.b2_maxTranslation=30,this.renderers=[]}return Domain.prototype.createB2World=function(gravity){this.b2World=new box2d.b2World(gravity),this.contactManager=new steer.ContactManager(this),this.b2World.SetContactListener(this.contactManager)},Domain.prototype.createBox2dDebugDraw=function(canvasId,flag){null!=this.b2World&&(this.box2dDebugDraw=new DebugDraw(document.getElementById(canvasId)),this.b2World.SetDebugDraw(this.box2dDebugDraw),this.box2dDebugDraw.SetFlags(flag))},Domain.prototype.clearAll=function(){},Domain.prototype.addRenderer=function(renderer){for(var found=!1,t=0;t<this.renderers.length;t++)if(this.renderers[t]===renderer){found=!0;break}found||this.renderers.push(renderer)},Domain.prototype.removeRenderer=function(renderer){for(var t=0;t<this.renderers.length;t++)if(this.renderers[t]===renderer){this.renderers[t]=null,this.renderers.splice(t);break}},Domain.prototype.remove=function(item){switch(item.constructor.name){case"Unit":case"Circle":case"Polygon":case"Edge":case"Path":this.items.remove(item),item.remove();break;case"Sensor":this.autoItems.remove(item),item.remove();break;case"GridMap":this.gridMaps.remove(item),item.remove()}item=null},Domain.prototype.setupSelector=function(selector){this.selector=selector},Domain.prototype.preUpdate=function(){var _this=this;if(this.items.each(function(item){item.prepareUpdateCache()},"Unit"),this.selector&&(this.selector.clear(),this.items.each(function(item){var itemSelector=_this.selector.getItemSelector(item);itemSelector&&_this.selector.insert(itemSelector)})),this.selector)for(var s=0;s<this.renderers.length;s++)this.renderers[s].preDomainUpdate()},Domain.prototype.update=function(delta){this.autoItems.each(function(item){item.update&&item.update()},"Sensor"),this.items.each(function(item){item.updateBeforeStep&&(item.updateBeforeStep(),"Unit"==item.constructor.name&&item.update(delta))}),this.b2World.Step(.016,10,10),this.b2World.m_debugDraw&&this.b2World.DrawDebugData(),this.items.each(function(item){item.updateAfterStep&&item.updateAfterStep()});for(var s=0;s<this.renderers.length;s++)this.renderers[s].domainUpdate()},Domain.prototype.integrate=function(delta){for(var s=0;s<this.renderers.length;s++)this.renderers[s].integrate(delta)},Domain}();steer.Domain=Domain}(steer||(steer={}));var steer;!function(steer){var ContactManager=function(){function ContactManager(domain){this.domain=domain,this.domain.b2World.SetContactListener(this)}return ContactManager.prototype.PostSolve=function(){},ContactManager.prototype.PreSolve=function(){},ContactManager.prototype.BeginContact=function(contact){var fixtureA=contact.GetFixtureA(),fixtureB=contact.GetFixtureB();if(!fixtureA.IsSensor()&&fixtureB.IsSensor()||fixtureA.IsSensor()&&!fixtureB.IsSensor()){var sensorOne=fixtureA.IsSensor()?fixtureA:fixtureB,targetOne=fixtureA.IsSensor()?fixtureB:fixtureA,sensor=sensorOne.GetBody().GetUserData().entity;"Unit"===targetOne.GetBody().GetUserData().entity.constructor.name&&(sensor.overLapItems[targetOne.GetBody().GetUserData().name]=targetOne.GetBody().GetUserData().entity,sensor.eventStart&&setTimeout(function(){sensor.eventStart.apply(sensor)},1))}},ContactManager.prototype.EndContact=function(contact){var fixtureA=contact.GetFixtureA(),fixtureB=contact.GetFixtureB();if(!fixtureA.IsSensor()&&fixtureB.IsSensor()||fixtureA.IsSensor()&&!fixtureB.IsSensor()){var sensorOne=fixtureA.IsSensor()?fixtureA:fixtureB,targetOne=fixtureA.IsSensor()?fixtureB:fixtureA,sensor=sensorOne.GetBody().GetUserData().entity;sensor.eventEnd&&setTimeout(function(){sensor.eventEnd.apply(sensor)},1),delete sensor.overLapItems[targetOne.GetBody().GetUserData().name]}},ContactManager}();steer.ContactManager=ContactManager}(steer||(steer={}));var steer;!function(steer){!function(controls){var BasicControls=function(){function BasicControls(){}return BasicControls.seek=function(unit,vector){return steer.Vector.sub(vector,unit.getb2Position()).limit(unit.maxForce)},BasicControls.flee=function(unit,vector){return steer.Vector.sub(unit.getb2Position(),vector).limit(unit.maxForce)},BasicControls.pursuit=function(unit,target){var offset=steer.Vector.sub(target.getb2Position(),unit.getb2Position()),distanceDelta=offset.mag()/target.maxSpeed,targetVelAvg=target.averageVelocity().mult(distanceDelta),futureAt=target.getb2Position().add(targetVelAvg);return BasicControls.seek(unit,futureAt)},BasicControls.evade=function(unit,target){var offset=steer.Vector.sub(target.getb2Position(),unit.getb2Position()),distanceDelta=offset.mag()/target.maxSpeed,targetVelAvg=target.averageVelocity().mult(distanceDelta),futureAt=target.getb2Position().add(targetVelAvg);return BasicControls.flee(unit,futureAt)},BasicControls.arrival=function(unit,vector,slowDownRatio){"undefined"==typeof slowDownRatio&&(slowDownRatio=2);var offset=steer.Vector.sub(vector,unit.getb2Position()),distance=offset.mag();if(distance<unit.maxSpeed*slowDownRatio){var mapValue=steer.MathUtil.map(distance,0,unit.maxSpeed*slowDownRatio,0,unit.maxSpeed);Math.abs(mapValue)<.01&&(mapValue=0),offset.normalize().mult(mapValue)}else offset.normalize().mult(unit.maxSpeed);var dest=steer.Vector.sub(offset,unit.velocity).limit(unit.maxForce).div(30);return dest},BasicControls.separation=function(unit,list){for(var sum=new steer.Vector(0,0),len=list.length,count=0,s=0;len>s;s++)if(unit!==list[s]&&list[s]instanceof steer.item.Unit){var distance=steer.Vector.distance(unit.getb2Position(),list[s].getb2Position()),calcuateRadius=list[s].separateRadius+unit.separateRadius;if(calcuateRadius>distance){var diff=steer.Vector.sub(unit.getb2Position(),list[s].getb2Position());diff.div(distance),sum.add(diff),count++}}return count>0&&(sum.div(count),sum.normalizeThanMult(unit.maxSpeed),sum.sub(unit.velocity),sum.limit(unit.maxForce)),sum},BasicControls.align=function(unit,list){for(var sum=new steer.Vector(0,0),len=list.length,count=0,s=0;len>s;s++)if(unit!==list[s]){var distance=steer.Vector.distance(unit.getb2Position(),list[s].getb2Position()),calcuateRadius=list[s].alignRadius+unit.alignRadius;calcuateRadius>distance&&(sum.add(list[s].velocity),count++)}return count>0&&(sum.div(count).normalizeThanMult(unit.maxSpeed),sum.limit(unit.maxForce)),sum},BasicControls.cohesion=function(unit,list){for(var sum=new steer.Vector(0,0),len=list.length,count=0,s=0;len>s;s++)if(unit!==list[s]&&list[s]instanceof steer.item.Unit){var distance=steer.Vector.distance(unit.getb2Position(),list[s].getb2Position()),calcuateRadius=list[s].cohesionRadius+unit.cohesionRadius;calcuateRadius>distance&&(sum.add(list[s].getb2Position()),count++)}return count>0?(sum.div(count),BasicControls.seek(unit,sum)):sum},BasicControls.initWander=function(unit,wanderRadius,wanderRatioDeg){unit.wanderRadius=wanderRadius,unit.wanderRatioDeg=wanderRatioDeg*Math.PI/180,unit.wanderCurrentAngle=Math.random()*Math.PI*2},BasicControls.wander=function(unit){if(null==unit.wanderRadius||null==unit.wanderRatioDeg||null==unit.wanderCurrentAngle)return new steer.Vector;var circleCenter=unit.velocity.clone();unit.wanderCurrentAngle+=.5*unit.wanderRatioDeg-Math.random()*unit.wanderRatioDeg;var wanderFoce=steer.Vector.fromAngle(unit.wanderCurrentAngle);return wanderFoce.mult(unit.wanderRadius),wanderFoce.add(circleCenter),wanderFoce},BasicControls}();controls.BasicControls=BasicControls}(steer.controls||(steer.controls={}));steer.controls}(steer||(steer={}));var steer;!function(steer){!function(controls){var AvoidControls=function(){function AvoidControls(){}return AvoidControls.avoidObstacle=function(unit){for(var hitCallbacks=[],rayInfo=unit.c_rayInfo,s=0;s<rayInfo.length;s+=2){var callBack=new box2d.RaycastCallback;callBack.ptStart=rayInfo[s].makeB2Vec(),callBack.ptEnd=rayInfo[s+1].makeB2Vec(),unit.domain.b2World.RayCast(callBack,callBack.ptStart,callBack.ptEnd),callBack.m_hit&&hitCallbacks.push(callBack)}var shortestPt,shortestNormal,shortestFixture,rayPtS,rayPtE,ddinfo=steer.render.DebugDrawInfo.getInfo(unit);if(hitCallbacks.length>0){for(var shortestDist=1e7,k=0;k<hitCallbacks.length;k++){var loopDist=steer.Vector.distanceSq(hitCallbacks[k].m_point,unit.getb2Position());shortestDist>loopDist&&(shortestDist=loopDist,shortestPt=hitCallbacks[k].m_point,shortestNormal=hitCallbacks[k].m_normal,shortestFixture=hitCallbacks[k].fixture,rayPtS=hitCallbacks[k].ptStart,rayPtE=hitCallbacks[k].ptEnd)}if(ddinfo&&ddinfo.drawMask&steer.render.DebugDrawInfo.AVOID_FORCE&&(ddinfo.avoidColor=13395558,ddinfo.avoidHitLoc=steer.Vector.fromb2Vec(shortestPt).sub(unit.getb2Position())),shortestFixture.GetType()==box2d.b2ShapeType.e_circleShape){var checkRange=unit.maxSpeed*unit.rayFrontRatio,distanceHitToUnit=checkRange-steer.Vector.distance(shortestPt,unit.getb2Position());if(distanceHitToUnit>0){var circlePos=shortestFixture.GetBody().GetPosition(),ppt=steer.Vector.getNormalPoint(steer.Vector.fromb2Vec(circlePos),rayInfo[4],rayInfo[5]),futureppt=steer.Vector.sub(ppt,unit.getb2Position()).normalizeThanMult(1).add(ppt),awayForce=checkRange-(checkRange-distanceHitToUnit),bounceAng=steer.Vector.sub(futureppt,steer.Vector.fromb2Vec(circlePos)).heading(),resultForce=steer.Vector.fromAngle(bounceAng).mult(.02*awayForce);return ddinfo&&ddinfo.drawMask&steer.render.DebugDrawInfo.AVOID_FORCE&&(ddinfo.avoidColor=13395558,ddinfo.avoidForce=resultForce.clone().mult(100)),resultForce}return new steer.Vector}var normalHeading=-Math.atan2(-shortestNormal.y,shortestNormal.x),bounceAng=2*normalHeading-Math.PI-unit.averageVelocity().heading(),distToObstacle=steer.Vector.distance(shortestPt,unit.getb2Position()),awayForce=unit.c_velocityLength-distToObstacle,resultForce=steer.Vector.fromAngle(bounceAng).mult(.01*awayForce);return ddinfo&&ddinfo.drawMask&steer.render.DebugDrawInfo.AVOID_FORCE&&(ddinfo.avoidColor=13395558,ddinfo.avoidForce=resultForce.clone().mult(100)),resultForce}return ddinfo&&(ddinfo.avoidForce=null,ddinfo.avoidHitLoc=null),new steer.Vector},AvoidControls.avoidUnit=function(unit,list){for(var threat,unitHitAt,threatHitAt,closestFutureHit,len=list.length,closestDist=Number.MAX_VALUE,resultVec=new steer.Vector,ddinfo=steer.render.DebugDrawInfo.getInfo(unit),s=0;len>s;s++)if(unit!==list[s]&&list[s]instanceof steer.item.Unit){var other=list[s],realDist=unit.getb2Position().dist(other.getb2Position());if(closestDist>realDist){closestDist=realDist;var checkDist=10*(unit.radius+other.radius),hitDist=AvoidControls.predictFutureHitDist(unit,other);if(closestFutureHit=hitDist,hitDist>0&&checkDist>hitDist){var unitTravel=steer.Vector.mult(unit.averageVelocity(),hitDist),otherTravel=steer.Vector.mult(other.averageVelocity(),hitDist),unitFrontAdd=unit.averageVelocity().clone().normalizeThanMult(unit.radius),otherFrontAdd=other.averageVelocity().clone().normalizeThanMult(other.radius);unitHitAt=unit.getb2Position().add(unitTravel).add(unitFrontAdd),threatHitAt=other.getb2Position().add(otherTravel).add(otherFrontAdd),threat=other}}}if(null!=threat){var checkDistRatio=.5*(unit.radius+other.radius+unit.c_velocityLength+other.c_velocityLength),threatNormal=threat.averageVelocity().clone().normalize(),unitNormal=unit.averageVelocity().clone().normalize(),angle=.707,sideVec=steer.Vector.fromAngle(unitNormal.heading()+.5*Math.PI),parallelness=unitNormal.dot(threatNormal);if(-angle>parallelness){if(threatHitAt.clone().sub(unit.getb2Position()).mag()<=checkDistRatio){{var offset=steer.Vector.sub(threatHitAt,unit.getb2Position());offset.dot(sideVec)}resultVec=sideVec,ddinfo&&(ddinfo.avoidColor=steer.render.DebugColors.DC_AVOID_FRONT,ddinfo.avoidForce=resultVec.clone(),ddinfo.avoidHitLoc=threatHitAt.clone().sub(unit.getb2Position()))}}else if(parallelness>angle){if(threatHitAt.clone().sub(unit.getb2Position()).mag()<=checkDistRatio){var unitToDist=unit.getb2Position().dist(unitHitAt),threatToDist=threat.getb2Position().dist(unitHitAt);if(unitToDist>=threatToDist&&!unit.avoidInfo.parallelAvoid){unit.avoidInfo.parallelAvoid=threat.avoidInfo.parallelAvoid=!0;var utDist=unit.getb2Position().dist(unitHitAt),ttDist=threat.getb2Position().dist(unitHitAt);if(utDist>ttDist){var offset=steer.Vector.sub(threat.getb2Position(),unit.getb2Position()),angleBetween=offset.dot(sideVec);sideVec=steer.Vector.fromAngle(unitNormal.heading()+1*Math.PI),angleBetween>0&&(sideVec=steer.Vector.fromAngle(unitNormal.heading()-1*Math.PI))}ddinfo&&(ddinfo.avoidColor=steer.render.DebugColors.DC_AVOID_PARALLEL,ddinfo.avoidForce=resultVec.clone(),ddinfo.avoidHitLoc=threatHitAt.clone().sub(unit.getb2Position())),resultVec=sideVec}}}else if(threatHitAt.clone().sub(unit.getb2Position()).mag()<=checkDistRatio){var unitToDist=unit.getb2Position().dist(threatHitAt),threatToDist=threat.getb2Position().dist(unitHitAt);if(unitToDist>=threatToDist&&!unit.avoidInfo.parallelAvoid){unit.avoidInfo.parallelAvoid=threat.avoidInfo.parallelAvoid=!0;var hitDirVector=threatHitAt.clone().sub(unit.getb2Position()),rayDirVector=unit.c_rayInfo[5].clone().sub(unit.c_rayInfo[4]),offDeg=4*steer.Vector.angleBetween(hitDirVector,rayDirVector);resultVec=steer.Vector.fromAngle(unitNormal.heading()+(Math.PI-offDeg)),ddinfo&&(ddinfo.avoidColor=steer.render.DebugColors.DC_AVOID_SIDE,ddinfo.avoidForce=resultVec.clone(),ddinfo.avoidHitLoc=threatHitAt.clone().sub(unit.getb2Position()))}}}return resultVec.isZero()&&ddinfo&&(ddinfo.avoidForce=null,ddinfo.avoidHitLoc=null),resultVec.div(200)},AvoidControls.predictFutureHitDist=function(unit,other){var relVelocity=steer.Vector.sub(other.averageVelocity(),unit.averageVelocity()),relSpeed=relVelocity.mag();if(0==relSpeed)return 0;var relTangent=steer.Vector.div(relVelocity,relSpeed),unitFrontAdd=unit.averageVelocity().clone().normalizeThanMult(unit.radius),otherFrontAdd=other.averageVelocity().clone().normalizeThanMult(other.radius),relLocation=steer.Vector.sub(unit.getb2Position().add(unitFrontAdd),other.getb2Position().add(otherFrontAdd)),projection=relTangent.dot(relLocation);return projection/relSpeed},AvoidControls}();controls.AvoidControls=AvoidControls}(steer.controls||(steer.controls={}));steer.controls}(steer||(steer={}));var steer;!function(steer){!function(controls){var PathAreaControls=function(){function PathAreaControls(){}return PathAreaControls.initPathUnit=function(unit,path,initOnshortestPt,loopOnPath,pathSeekAheadAmt){"undefined"==typeof initOnshortestPt&&(initOnshortestPt=!0),"undefined"==typeof loopOnPath&&(loopOnPath=!1),"undefined"==typeof pathSeekAheadAmt&&(pathSeekAheadAmt=1);var closestPt,closeDist=Number.MAX_VALUE,closeIndex=0,ptSize=path.segments.length;if(initOnshortestPt)for(var s=0;ptSize>s;s++){var dist=steer.Vector.distanceSq(unit.getb2Position(),path.segments[s]);closeDist>dist&&(closeDist=dist,closestPt=path.segments[s],closeIndex=s)}unit.pathAtIndex=closeIndex,unit.loopOnPath=loopOnPath,unit.pathSeekAheadAmt=pathSeekAheadAmt},PathAreaControls.followPath=function(unit,path){if(unit.pathAtIndex+1>=path.segments.length&&0==unit.loopOnPath){var lastPathPoint=path.segments[path.segments.length-1];return controls.Behavior.arrival(unit,lastPathPoint)}var ddinfo=steer.render.DebugDrawInfo.getInfo(unit),ahead=unit.velocity.clone();ahead.normalizeThanMult(unit.maxSpeed*unit.pathVelocityRatio),null!=ddinfo&&(ddinfo.pathPredict=ahead.clone());
var predictLoc=steer.Vector.add(unit.getb2Position(),ahead),pathPt1=path.segments[unit.pathAtIndex],pathPt2=path.segments[unit.pathAtIndex+1]?path.segments[unit.pathAtIndex+1]:path.segments[0],normalPoint=steer.Vector.getNormalPoint(predictLoc,pathPt1,pathPt2);null!=ddinfo&&(ddinfo.pathNormal=normalPoint.clone().sub(unit.getb2Position()));for(var shortestPt,furtherPts=path.segments.concat(path.segments),shortest=Number.MAX_VALUE,shortestIndex=-1,f=1;f<unit.pathSeekAheadAmt+1;f++){var loopDist=steer.Vector.distanceSq(unit.getb2Position(),furtherPts[unit.pathAtIndex+f]);furtherPts[unit.pathAtIndex+f]&&shortest>loopDist&&(shortest=loopDist,shortestIndex=unit.pathAtIndex+f,shortestPt=furtherPts[unit.pathAtIndex+f])}var maxRange=unit.radius+path.pathWidth;steer.Vector.distance(unit.getb2Position(),shortestPt)<=maxRange&&unit.pathAtIndex<path.segments.length&&(unit.pathAtIndex=shortestIndex,unit.pathAtIndex>=path.segments.length&&unit.loopOnPath&&(unit.pathAtIndex=0));var target,frontLoc=steer.Vector.fromAngle(steer.MathUtil.angleBtweenPt(pathPt1,pathPt2),unit.maxSpeed*unit.pathOnFrontRatio),pathdv=steer.Vector.sub(pathPt2,pathPt1),normaldv=steer.Vector.sub(normalPoint,pathPt1),distPt12=steer.Vector.sub(pathPt2,pathPt1).mag(),distUnitPt2=steer.Vector.sub(pathPt2,unit.getb2Position()).mag();if(steer.Vector.angleBetween(pathdv,normaldv)>1.5707)return target=steer.Vector.add(pathPt1,frontLoc),null!=ddinfo&&(ddinfo.pathOnFront=target.clone().sub(unit.getb2Position())),controls.Behavior.seek(unit,target);if(.5*distUnitPt2>distPt12||unit.velocity.mag()<.5*unit.maxSpeed)return target=pathPt2,null!=ddinfo&&(ddinfo.pathOnFront=target.clone().sub(unit.getb2Position())),controls.Behavior.seek(unit,target);target=steer.Vector.add(normalPoint,frontLoc),null!=ddinfo&&(ddinfo.pathOnFront=target.clone().sub(unit.getb2Position()));var distance=steer.Vector.distance(predictLoc,normalPoint)+unit.radius;return distance>.5*path.pathWidth||unit.velocity.mag()<.5*unit.maxSpeed?controls.Behavior.seek(unit,target):new steer.Vector(0,0)},PathAreaControls.gridmapForce=function(unit,gridmap){if(null==gridmap.velocityData)return new steer.Vector;var unitCir={x:unit.getb2X(),y:unit.getb2Y(),r:unit.radius},gridmapRec={x:gridmap.x,y:gridmap.y,w:gridmap.w,h:gridmap.h};if(steer.MathUtil.rectCircleCollide(unitCir,gridmapRec)){var sx=unit.getb2X()-gridmap.x-unit.radius,ex=sx+2*unit.radius,sy=unit.getb2Y()-gridmap.y-unit.radius,ey=sy+2*unit.radius,xspos=Math.floor(sx/gridmap.blockSize.x),xepos=Math.floor(ex/gridmap.blockSize.x),yspos=Math.floor(sy/gridmap.blockSize.y),yepos=Math.floor(ey/gridmap.blockSize.y);0>xspos&&(xspos=0),0>yspos&&(yspos=0),xspos>=gridmap.gridSize.x&&(xspos=gridmap.gridSize.x),yspos>=gridmap.gridSize.y&&(yspos=gridmap.gridSize.y),xspos==xepos&&(xepos+=1),yspos==yepos&&(yepos+=1);for(var addCount=0,addForce=new steer.Vector,lx=xspos;xepos>lx;lx++)for(var ly=yspos;yepos>ly;ly++)lx>-1&&ly>-1&&lx<gridmap.gridSize.x&&ly<gridmap.gridSize.y&&gridmap.velocityData[lx][ly]&&(addForce.add(gridmap.velocityData[lx][ly]),addCount++);return addForce.div(addCount),addForce}return new steer.Vector},PathAreaControls}();controls.PathAreaControls=PathAreaControls}(steer.controls||(steer.controls={}));steer.controls}(steer||(steer={}));var steer;!function(steer){!function(controls){var Behavior=function(){function Behavior(){}return Behavior.seek=function(unit,vector){return controls.BasicControls.seek(unit,vector)},Behavior.avoidObstacle=function(unit){return controls.AvoidControls.avoidObstacle(unit)},Behavior.flee=function(unit,vector){return controls.BasicControls.flee(unit,vector)},Behavior.pursuit=function(unit,target){return controls.BasicControls.pursuit(unit,target)},Behavior.evade=function(unit,target){return controls.BasicControls.evade(unit,target)},Behavior.arrival=function(unit,vector,slowDownRatio){return"undefined"==typeof slowDownRatio&&(slowDownRatio=2),controls.BasicControls.arrival(unit,vector,slowDownRatio)},Behavior.separation=function(unit,list){return controls.BasicControls.separation(unit,list)},Behavior.align=function(unit,list){return controls.BasicControls.align(unit,list)},Behavior.cohesion=function(unit,list){return controls.BasicControls.cohesion(unit,list)},Behavior.initPathUnit=function(unit,path,initOnshortestPt,loopOnPath,pathSeekAheadAmt){return"undefined"==typeof initOnshortestPt&&(initOnshortestPt=!0),"undefined"==typeof loopOnPath&&(loopOnPath=!1),"undefined"==typeof pathSeekAheadAmt&&(pathSeekAheadAmt=1),controls.PathAreaControls.initPathUnit(unit,path,initOnshortestPt,loopOnPath,pathSeekAheadAmt)},Behavior.followPath=function(unit,path){return controls.PathAreaControls.followPath(unit,path)},Behavior.initWander=function(unit,wanderRadius,wanderRatioDeg){return controls.BasicControls.initWander(unit,wanderRadius,wanderRatioDeg)},Behavior.wander=function(unit){return controls.BasicControls.wander(unit)},Behavior.unalignedAvoidance=function(){return new steer.Vector},Behavior.avoidUnit=function(unit,list){return controls.AvoidControls.avoidUnit(unit,list)},Behavior.gridmapForce=function(unit,grid){return controls.PathAreaControls.gridmapForce(unit,grid)},Behavior}();controls.Behavior=Behavior}(steer.controls||(steer.controls={}));steer.controls}(steer||(steer={}));var steer;!function(steer){!function(render){var DebugColors=function(){function DebugColors(){}return DebugColors.rgbaToHex=function(rgba){var rgbData=rgba.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return rgbData&&4===rgbData.length?"#"+("0"+parseInt(rgbData[1],10).toString(16)).slice(-2)+("0"+parseInt(rgbData[2],10).toString(16)).slice(-2)+("0"+parseInt(rgbData[3],10).toString(16)).slice(-2):""},DebugColors.hexToRgba=function(hex,opacity){hex=hex.replace("#","");var r=parseInt(hex.substring(0,2),16),g=parseInt(hex.substring(2,4),16),b=parseInt(hex.substring(4,6),16),result="rgba("+r+","+g+","+b+","+opacity/100+")";return result},DebugColors.DC_PATH_FILL=9851040,DebugColors.DC_PATH_FILL_SA=.4,DebugColors.DC_PATH_FILL_A=.1,DebugColors.DC_PATH_GUIDE=3407871,DebugColors.DC_PATH_GUIDE_A=.3,DebugColors.DC_PATH_GUIDE_A2=.2,DebugColors.DC_WANDER=9868950,DebugColors.DC_WANDER_A=.5,DebugColors.DC_ALIGNMENT=5276250,DebugColors.DC_ALIGNMENT_A=.3,DebugColors.DC_COHESION=5931650,DebugColors.DC_COHESION_A=.3,DebugColors.DC_SEPARATION=15093840,DebugColors.DC_SEPARATION_A=.3,DebugColors.DC_RAYCAST=2001950,DebugColors.DC_RAYCAST_A=.3,DebugColors.DC_STATIC=6316128,DebugColors.DC_STATIC_A=.3,DebugColors.DC_DYNAMIC=10526880,DebugColors.DC_DYNAMIC_A=.3,DebugColors.DC_QUAD=5622988,DebugColors.DC_QUAD_A=.5,DebugColors.DC_SENSOR=16768392,DebugColors.DC_SENSOR_A=.3,DebugColors.DC_SENSOR_STATIC=16768392,DebugColors.DC_SENSOR_STATIC_A=.1,DebugColors.DC_GRID=6750207,DebugColors.DC_GRID_A=.1,DebugColors.DC_GRID_BLOCK=6750207,DebugColors.DC_GRID_BLOCK_A=.1,DebugColors.DC_AVOID_FRONT=14522777,DebugColors.DC_AVOID_SIDE=16768358,DebugColors.DC_AVOID_PARALLEL=6724061,DebugColors}();render.DebugColors=DebugColors}(steer.render||(steer.render={}));steer.render}(steer||(steer={}));var steer;!function(steer){!function(render){var DebugDrawInfo=function(){function DebugDrawInfo(toItem){"undefined"==typeof toItem&&(toItem=null),this.drawMask=DebugDrawInfo.SHOW_FILL|DebugDrawInfo.SHOW_EDGE,toItem&&(this.toItemName=toItem.name)}return DebugDrawInfo.create=function(item){var newOne=new DebugDrawInfo(item);return DebugDrawInfo.allInfos[item.name]=newOne,newOne},DebugDrawInfo.exist=function(item){return DebugDrawInfo.allInfos[item.name]?!0:!1},DebugDrawInfo.getAlpha=function(item,defaultAlpha){return DebugDrawInfo.allInfos[item.name]&&DebugDrawInfo.allInfos[item.name].alpha?DebugDrawInfo.allInfos[item.name].alpha:defaultAlpha},DebugDrawInfo.getColor=function(item,defaultColor){return DebugDrawInfo.allInfos[item.name]&&DebugDrawInfo.allInfos[item.name].color?DebugDrawInfo.allInfos[item.name].color:defaultColor},DebugDrawInfo.getInfo=function(item){return DebugDrawInfo.allInfos[item.name]?DebugDrawInfo.allInfos[item.name]:null},DebugDrawInfo.SHOW_FILL=1,DebugDrawInfo.SHOW_EDGE=2,DebugDrawInfo.UNIT_SEPARATION=4,DebugDrawInfo.UNIT_ALIGNMENT=8,DebugDrawInfo.UNIT_COHESION=16,DebugDrawInfo.UNIT_RAYCAST=32,DebugDrawInfo.UNIT_WANDER=64,DebugDrawInfo.UNIT_PATH_INFO=128,DebugDrawInfo.BOUNDING_BOX=256,DebugDrawInfo.AVOID_FORCE=512,DebugDrawInfo.allInfos={},DebugDrawInfo}();render.DebugDrawInfo=DebugDrawInfo}(steer.render||(steer.render={}));steer.render}(steer||(steer={}));var steer;!function(steer){!function(render){var PixiDebugRenderer=function(_super){function PixiDebugRenderer(domain,stage,renderer,w,h){_super.call(this,domain,w,h),this.remakeCounter=0,this.pixiRenderer=renderer,this.pixiStage=stage,PixiDebugRenderer.instance=this,this.container=new PIXI.DisplayObjectContainer,this.guideContainer=new PIXI.DisplayObjectContainer,this.pixiStage.addChild(this.container),this.pixiStage.addChild(this.guideContainer),this.container.scale=new PIXI.Point(30,30),this.guideContainer.scale=new PIXI.Point(30,30),this.container.position=new PIXI.Point(0,0),this.guideContainer.position=new PIXI.Point(0,0),this.guideGrahpic=new PIXI.Graphics,this.quadGraphic=new PIXI.Graphics,this.guideContainer.addChild(this.guideGrahpic),this.guideContainer.addChild(this.quadGraphic)}return __extends(PixiDebugRenderer,_super),PixiDebugRenderer.prototype.recreateContainer=function(){this.domain.items.each(function(item){item.pixiDebugItem&&(item.pixiDebugItem=void 0)}),this.domain.autoItems.each(function(item){item.pixiDebugItem&&(item.pixiDebugItem=void 0)}),this.domain.gridMaps.each(function(item){item.pixiDebugItem&&(item.pixiDebugItem=void 0)}),this.pixiStage.removeChild(this.container),this.container.removeStageReference(),this.container=void 0,this.container=new PIXI.DisplayObjectContainer,this.container.scale=new PIXI.Point(30,30),this.pixiStage.addChild(this.container)},PixiDebugRenderer.prototype.visualRender=function(){var _this=this;this.domain.gridMaps.each(function(item){if(null==item.pixiDebugItem){var graphic=new PIXI.Graphics;item.pixiDebugItem=graphic,_this.container.addChild(graphic),_this.drawGridmap(item)}}),this.pixiRenderer.render(this.pixiStage)},PixiDebugRenderer.prototype.itemRender=function(item,delta){var xto,yto,rto=0;item.b2body&&(xto=item.getb2X(),yto=item.getb2Y(),rto=item.b2body.GetAngle()),item.dynamic&&(xto=item.getb2X()+item.diffPosition.x*delta,yto=item.getb2Y()+item.diffPosition.y*delta,rto=item.b2body.GetAngle()+item.diffRotation*delta);var itemType=item.constructor.name;if(null==item.pixiDebugItem){var graphic=new PIXI.Graphics;item.pixiDebugItem=graphic,this.container.addChild(graphic);var color=item.dynamic?render.DebugColors.DC_DYNAMIC:render.DebugColors.DC_STATIC,alpha=item.dynamic?render.DebugColors.DC_DYNAMIC_A:render.DebugColors.DC_STATIC_A;switch(itemType){case"Unit":this.makeCircle(xto,yto,rto,item,color,alpha);break;case"Circle":this.makeCircle(xto,yto,rto,item,color,alpha);break;case"Polygon":this.makePolygon(xto,yto,rto,item,color,alpha);break;case"Edge":this.makeEdge(xto,yto,rto,item,color,alpha);break;case"Path":this.makePath(item);break;case"Sensor":this.makeSensor(xto,yto,rto,item)}}else if(item.dynamic)switch(itemType){case"Unit":this.updateUnitInfo(xto,yto,rto,item);break;case"Circle":this.updateCircle(xto,yto,rto,item,render.DebugColors.DC_DYNAMIC,render.DebugColors.DC_DYNAMIC_A);break;case"Polygon":this.updatePolygon(xto,yto,rto,item,render.DebugColors.DC_DYNAMIC,render.DebugColors.DC_DYNAMIC_A);break;case"Edge":this.makeEdge(xto,yto,rto,item,render.DebugColors.DC_DYNAMIC,render.DebugColors.DC_DYNAMIC_A);break;case"Sensor":this.makeSensor(xto,yto,rto,item);break;case"Path":}},PixiDebugRenderer.prototype.preDomainUpdate=function(){this.drawQuadTree()},PixiDebugRenderer.prototype.makeCircle=function(xto,yto,rto,item,color,alpha){var g=item.pixiDebugItem;g.clear(),g.beginFill(color,alpha),g.drawCircle(0,0,item.radius),g.position.x=xto,g.position.y=yto,g.rotation=rto,g.endFill()},PixiDebugRenderer.prototype.updateCircle=function(xto,yto,rto,item){var g=item.pixiDebugItem;g.position.x=xto,g.position.y=yto,g.rotation=rto},PixiDebugRenderer.prototype.updateUnitInfo=function(xto,yto,rto,item){var g=item.pixiDebugItem;g.clear();var color=render.DebugDrawInfo.getColor(item,render.DebugColors.DC_DYNAMIC),alpha=render.DebugDrawInfo.getAlpha(item,render.DebugColors.DC_DYNAMIC_A);item.dynamic||(color=render.DebugColors.DC_STATIC,alpha=render.DebugColors.DC_STATIC_A),g.beginFill(color,alpha),g.drawCircle(0,0,item.radius),g.position.x=xto,g.position.y=yto,g.rotation=rto,g.endFill();var ddinfo=render.DebugDrawInfo.getInfo(item);if(null!=ddinfo&&null!=item.c_rayInfo){if(g.lineStyle(.03,render.DebugColors.DC_RAYCAST,render.DebugColors.DC_RAYCAST_A),ddinfo.drawMask&render.DebugDrawInfo.UNIT_RAYCAST){var rayPts=item.c_rayInfo;if(item.c_velocityLength>=.8)for(var s=0;s<rayPts.length;s+=2){var ix=item.getb2X(),iy=item.getb2Y();g.moveTo(rayPts[s].x-ix-.5,rayPts[s].y-iy-.5),g.lineTo(rayPts[s+1].x-ix-.5,rayPts[s+1].y-iy-.5)}}if(ddinfo.drawMask&render.DebugDrawInfo.UNIT_SEPARATION&&(g.lineStyle(.03,render.DebugColors.DC_SEPARATION,render.DebugColors.DC_SEPARATION_A),g.drawCircle(-.5,-.5,item.separateRadius)),ddinfo.drawMask&render.DebugDrawInfo.UNIT_COHESION&&(g.lineStyle(.03,render.DebugColors.DC_COHESION,render.DebugColors.DC_COHESION_A),g.drawCircle(-.5,-.5,item.cohesionRadius)),ddinfo.drawMask&render.DebugDrawInfo.UNIT_ALIGNMENT&&(g.lineStyle(.03,render.DebugColors.DC_ALIGNMENT,render.DebugColors.DC_ALIGNMENT_A),g.drawCircle(-.5,-.5,item.alignRadius)),ddinfo.drawMask&render.DebugDrawInfo.UNIT_WANDER){g.lineStyle(.03,render.DebugColors.DC_WANDER,render.DebugColors.DC_WANDER_A);var rxto=-.5,ryto=-.5;g.drawCircle(rxto,ryto,item.wanderRadius);var minAng=item.velocity.heading()-.5*item.wanderRatioDeg,addAng=item.velocity.heading()+.5*item.wanderRatioDeg;g.moveTo(-.5,-.5),g.lineTo(-.5+Math.cos(minAng)*item.wanderRadius,-.5+Math.sin(minAng)*item.wanderRadius),g.moveTo(-.5,-.5),g.lineTo(-.5+Math.cos(addAng)*item.wanderRadius,-.5+Math.sin(addAng)*item.wanderRadius)}if(ddinfo.drawMask&render.DebugDrawInfo.UNIT_PATH_INFO&&ddinfo.pathPredict&&(g.lineStyle(.05,render.DebugColors.DC_PATH_GUIDE,render.DebugColors.DC_PATH_GUIDE_A),g.drawCircle(ddinfo.pathPredict.x-.5,ddinfo.pathPredict.y-.5,.05),g.drawCircle(ddinfo.pathNormal.x-.5,ddinfo.pathNormal.y-.5,.05),g.moveTo(-.5,-.5),g.lineTo(ddinfo.pathPredict.x-.5,ddinfo.pathPredict.y-.5),g.lineTo(ddinfo.pathNormal.x-.5,ddinfo.pathNormal.y-.5),g.drawCircle(ddinfo.pathOnFront.x-.5,ddinfo.pathOnFront.y-.5,.1),g.moveTo(ddinfo.pathPredict.x-.5,ddinfo.pathPredict.y-.5),g.lineTo(ddinfo.pathOnFront.x-.5,ddinfo.pathOnFront.y-.5)),ddinfo.drawMask&render.DebugDrawInfo.BOUNDING_BOX){var bbox=item.getBoundingBox();g.lineStyle(.03,render.DebugColors.DC_QUAD,render.DebugColors.DC_QUAD_A),g.drawRect(bbox.x-item.getb2Position().x-.5,bbox.y-item.getb2Position().y-.5,bbox.w,bbox.h)}ddinfo.drawMask&render.DebugDrawInfo.AVOID_FORCE&&ddinfo.avoidForce&&(g.lineStyle(.05,ddinfo.avoidColor,.8),ddinfo.avoidForce&&(g.moveTo(-.5,-.5),g.lineTo(ddinfo.avoidForce.x-.5,ddinfo.avoidForce.y-.5),g.drawCircle(ddinfo.avoidForce.x-.5,ddinfo.avoidForce.y-.5,.05)),ddinfo.avoidHitLoc&&(g.lineStyle(.05,ddinfo.avoidColor,.4),g.moveTo(-.5,-.5),g.lineTo(ddinfo.avoidHitLoc.x-.5,ddinfo.avoidHitLoc.y-.5)))}},PixiDebugRenderer.prototype.makePolygon=function(xto,yto,rto,item,color,alpha){var g=item.pixiDebugItem;g.clear(),g.beginFill(color,alpha);for(var t=0;t<item.shapeLen;t++)for(var m=0;m<item.shapes[t].m_count;m++){var vertice=item.shapes[t].m_vertices[m];0==m?g.moveTo(vertice.x,vertice.y):g.lineTo(vertice.x,vertice.y),m+1==item.shapes[t].m_count&&g.lineTo(item.shapes[t].m_vertices[0].x,item.shapes[t].m_vertices[0].y)}g.position.x=xto,g.position.y=yto,g.rotation=rto,g.endFill()},PixiDebugRenderer.prototype.updatePolygon=function(xto,yto,rto,item){var g=item.pixiDebugItem;g.position.x=xto,g.position.y=yto,g.rotation=rto},PixiDebugRenderer.prototype.makeSensor=function(xto,yto,rto,item){var color=item.dynamic?render.DebugColors.DC_SENSOR:render.DebugColors.DC_SENSOR_STATIC,alpha=item.dynamic?render.DebugColors.DC_SENSOR_A:render.DebugColors.DC_SENSOR_STATIC_A;item.shapeType==steer.item.Sensor.SHAPE_BOX?this.makePolygon(xto,yto,rto,item,color,alpha):this.makeCircle(xto,yto,rto,item,color,alpha);var g=item.pixiDebugItem;if(item.forceType==steer.item.Sensor.FORCE_PUSH_CENTER){g.beginFill(16777215,.2);var v=.2;g.moveTo(-v,-v),g.lineTo(0,2*-v),g.lineTo(v,-v),g.moveTo(-v,-v),g.lineTo(2*-v,0),g.lineTo(-v,v),g.moveTo(v,-v),g.lineTo(2*v,0),g.lineTo(v,v),g.moveTo(-v,v),g.lineTo(0,2*v),g.lineTo(v,v),g.endFill()}if(item.forceType==steer.item.Sensor.FORCE_PULL_CENTER){g.beginFill(16777215,.2);var v=.2;g.moveTo(-v,2*-v),g.lineTo(0,-v),g.lineTo(v,2*-v),g.moveTo(2*-v,-v),g.lineTo(-v,0),g.lineTo(2*-v,v),g.moveTo(2*v,-v),g.lineTo(v,0),g.lineTo(2*v,v),g.moveTo(-v,2*v),g.lineTo(0,v),g.lineTo(v,2*v),g.endFill()}if(item.forceType==steer.item.Sensor.FORCE_PUSH_VECTOR){g.beginFill(16777215,.3),g.drawCircle(Math.cos(item.forceAngle)*-.15,Math.sin(item.forceAngle)*-.15,.05);var xto1=.2*Math.cos(item.forceAngle+1.5707),yto1=.2*Math.sin(item.forceAngle+1.5707),xto2=.35*Math.cos(item.forceAngle),yto2=.35*Math.sin(item.forceAngle),xto3=.2*Math.cos(item.forceAngle-1.5707),yto3=.2*Math.sin(item.forceAngle-1.5707);g.endFill(),g.beginFill(16777215,.3),g.moveTo(xto1,yto1),g.lineTo(xto2,yto2),g.lineTo(xto3,yto3),g.endFill()}},PixiDebugRenderer.prototype.makeEdge=function(xto,yto,rto,item,color,alpha){var g=item.pixiDebugItem;g.lineStyle(.03,color,alpha),g.position.x=xto-.5,g.position.y=yto-.5,g.rotation=rto;for(var t=0;t<item.shapeLen;t++){var loopShape=item.shapes[t];g.moveTo(loopShape.m_vertex1.x,loopShape.m_vertex1.y),g.lineTo(loopShape.m_vertex2.x,loopShape.m_vertex2.y)}},PixiDebugRenderer.prototype.makePath=function(item){var g=item.pixiDebugItem;g.position.x=0,g.position.y=0,g.lineStyle(.03,render.DebugColors.DC_PATH_FILL,render.DebugColors.DC_PATH_FILL_SA);for(var plen=item.segments.length,k=0;plen>k;k++){var seg=item.segments[k];g.drawCircle(seg.x-.5,seg.y-.5,.05)}var dlen=item.drawInfo.length;g.moveTo(item.segments[0].x-.5,item.segments[0].y-.5);for(var k=0;dlen>k;k++){var di=item.drawInfo[k];di.type==steer.item.PathDrawInfo.TYPE_LINE&&g.lineTo(di.end.x-.5,di.end.y-.5),di.type==steer.item.PathDrawInfo.TYPE_BEZIER&&g.bezierCurveTo(di.cp1.x-.5,di.cp1.y-.5,di.cp2.x-.5,di.cp2.y-.5,di.end.x-.5,di.end.y-.5)}var iw=item.pathWidth+1e-6;g.lineStyle(iw,render.DebugColors.DC_PATH_FILL,render.DebugColors.DC_PATH_FILL_A),g.moveTo(item.segments[0].x-.5,item.segments[0].y-.5);for(var k=0;dlen>k;k++){var di=item.drawInfo[k];di.type==steer.item.PathDrawInfo.TYPE_LINE&&g.lineTo(di.end.x-.5,di.end.y-.5),di.type==steer.item.PathDrawInfo.TYPE_BEZIER&&g.bezierCurveTo(di.cp1.x-.5,di.cp1.y-.5,di.cp2.x-.5,di.cp2.y-.5,di.end.x-.5,di.end.y-.5)}},PixiDebugRenderer.prototype.drawGridmap=function(item){var g=item.pixiDebugItem;g.clear(),g.position.x=item.x,g.position.y=item.y,g.lineStyle(.03,render.DebugColors.DC_GRID,render.DebugColors.DC_GRID_A);for(var y=0;y<item.gridSize.y+1;y++){var ys=item.blockSize.y*y,xto=item.gridSize.x*item.blockSize.x;g.moveTo(-0.5,ys-.5),g.lineTo(xto-.5,ys-.5)}for(var x=0;x<item.gridSize.x+1;x++){var xs=item.blockSize.x*x,yto=item.gridSize.y*item.blockSize.y;g.moveTo(xs-.5,-0.5),g.lineTo(xs-.5,yto-.5)}if(item.velocityData)for(var lx=0;lx<item.gridSize.x;lx++)for(var ly=0;ly<item.gridSize.y;ly++)if(item.velocityData[lx]&&item.velocityData[lx][ly]){var xpos=item.blockSize.x*(lx+.5)-.5,ypos=item.blockSize.y*(ly+.5)-.5;g.moveTo(xpos,ypos);var dirVec=item.velocityData[lx][ly].clone().normalize(),dirDrawX=dirVec.x*item.blockSize.x*.4,dirDrawY=dirVec.y*item.blockSize.y*.4;g.lineTo(xpos+dirDrawX,ypos+dirDrawY)}if(item.pathData){g.lineStyle(0,0,0);for(var lx=0;lx<item.gridSize.x;lx++)for(var ly=0;ly<item.gridSize.y;ly++)if(!item.pathData.isWalkableAt(lx,ly)){var xpos=item.blockSize.x*lx,ypos=item.blockSize.y*ly;g.beginFill(render.DebugColors.DC_GRID_BLOCK,render.DebugColors.DC_GRID_BLOCK_A),g.drawRect(xpos,ypos,item.blockSize.x,item.blockSize.y),g.endFill()}}},PixiDebugRenderer.prototype.drawDot=function(position,color,radius,alpha){"undefined"==typeof radius&&(radius=.03),"undefined"==typeof alpha&&(alpha=1);var g=this.guideGrahpic;g.lineStyle(.03,color,alpha),g.drawCircle(position.x-.5,position.y-.5,radius),g.endFill()},PixiDebugRenderer.prototype.drawSegment=function(fromPos,toPos,color,width,alpha){"undefined"==typeof width&&(width=.03),"undefined"==typeof alpha&&(alpha=1);var g=this.guideGrahpic;g.lineStyle(width,color,alpha),g.moveTo(fromPos.x-.5,fromPos.y-.5),g.lineTo(toPos.x-.5,toPos.y-.5)},PixiDebugRenderer.prototype.drawRectangle=function(x,y,w,h,color,alpha){var g=this.guideGrahpic;g.lineStyle(.03,color,alpha),g.drawRect(x-.5,y-.5,w,h),g.endFill()},PixiDebugRenderer.prototype.drawQuadTree=function(){this.quadGraphic.clear(),this.domain.selector.rootNode&&this.drawTreeNode(this.domain.selector.rootNode)},PixiDebugRenderer.prototype.drawTreeNode=function(targetNode){if(targetNode.nodes.length>0)for(var i=0;i<targetNode.nodes.length;i++)this.drawTreeNode(targetNode.nodes[i]);var g=this.quadGraphic;g.lineStyle(.03,render.DebugColors.DC_QUAD,render.DebugColors.DC_QUAD_A),g.drawRect(targetNode.x-.5,targetNode.y-.5,targetNode.width,targetNode.height)},PixiDebugRenderer}(steer.BaseRender);render.PixiDebugRenderer=PixiDebugRenderer}(steer.render||(steer.render={}));steer.render}(steer||(steer={})),box2d.RaycastCallback=function(){box2d.b2RayCastCallback.call(this),this.m_point=new box2d.b2Vec2,this.m_normal=new box2d.b2Vec2},goog.inherits(box2d.RaycastCallback,box2d.b2RayCastCallback),box2d.RaycastCallback.prototype.m_hit=!1,box2d.RaycastCallback.prototype.m_point=null,box2d.RaycastCallback.prototype.m_normal=null,box2d.RaycastCallback.prototype.fixture=null,box2d.RaycastCallback.prototype.ptStart=null,box2d.RaycastCallback.prototype.ptEnd=null,box2d.RaycastCallback.prototype.ReportFixture=function(fixture,point,normal,fraction){fixture.GetBody();return this.m_hit=!0,this.fixture=fixture,this.m_point.Copy(point),this.m_normal.Copy(normal),fraction},goog.provide("DebugDraw"),goog.require("box2d"),goog.require("goog.string.format"),DebugDraw=function(canvas){box2d.b2Draw.call(this),this.m_canvas=canvas,this.m_ctx=this.m_canvas.getContext("2d"),this.m_settings={canvasScale:1,viewZoom:1}},goog.inherits(DebugDraw,box2d.b2Draw),DebugDraw.prototype.m_canvas=null,DebugDraw.prototype.m_ctx=null,DebugDraw.prototype.m_settings=null,DebugDraw.prototype.PushTransform=function(xf){var ctx=this.m_ctx;ctx.save(),ctx.scale(30,30),ctx.translate(xf.p.x,xf.p.y),ctx.rotate(xf.q.GetAngleRadians())},DebugDraw.prototype.PopTransform=function(){var ctx=this.m_ctx;ctx.restore()},DebugDraw.prototype.DrawPolygon=function(vertices,vertexCount,color){if(vertexCount){var ctx=this.m_ctx;ctx.beginPath(),ctx.moveTo(vertices[0].x,vertices[0].y);for(var i=1;vertexCount>i;i++)ctx.lineTo(vertices[i].x,vertices[i].y);ctx.closePath(),ctx.strokeStyle=color.MakeStyleString(1),ctx.lineWidth=.03,ctx.stroke()}},DebugDraw.prototype.DrawSolidPolygon=function(vertices,vertexCount,color){if(vertexCount){var ctx=this.m_ctx;ctx.beginPath(),ctx.moveTo(vertices[0].x,vertices[0].y);for(var i=1;vertexCount>i;i++)ctx.lineTo(vertices[i].x,vertices[i].y);ctx.closePath(),ctx.fillStyle=color.MakeStyleString(.5),ctx.fill(),ctx.strokeStyle=color.MakeStyleString(1),ctx.lineWidth=.03,ctx.stroke()}},DebugDraw.prototype.DrawCircle=function(center,radius,color){if(radius){var ctx=this.m_ctx;ctx.beginPath(),ctx.arc(center.x,center.y,radius,0,2*box2d.b2_pi,!0),ctx.strokeStyle=color.MakeStyleString(1),ctx.lineWidth=.03,ctx.stroke()}},DebugDraw.prototype.DrawSolidCircle=function(center,radius,axis,color){if(radius){var ctx=this.m_ctx,cx=center.x,cy=center.y;ctx.lineWidth=.03,ctx.beginPath(),ctx.arc(cx,cy,radius,0,2*box2d.b2_pi,!0),ctx.moveTo(cx,cy),ctx.lineTo(cx+axis.x*radius,cy+axis.y*radius),ctx.fillStyle=color.MakeStyleString(.5),ctx.fill(),ctx.strokeStyle=color.MakeStyleString(1),ctx.stroke()}},DebugDraw.prototype.DrawSegment=function(p1,p2,color){var ctx=this.m_ctx;ctx.lineWidth=.03,ctx.beginPath(),ctx.moveTo(p1.x,p1.y),ctx.lineTo(p2.x,p2.y),ctx.strokeStyle=color.MakeStyleString(1),ctx.stroke()},DebugDraw.prototype.DrawTransform=function(xf){var ctx=this.m_ctx;this.PushTransform(xf),ctx.scale(.03,.03),ctx.beginPath(),ctx.moveTo(0,0),ctx.lineTo(1,0),ctx.strokeStyle=box2d.b2Color.RED.MakeStyleString(1),ctx.stroke(),ctx.beginPath(),ctx.moveTo(0,0),ctx.lineTo(0,1),ctx.strokeStyle=box2d.b2Color.GREEN.MakeStyleString(1),ctx.stroke(),this.PopTransform(xf)},DebugDraw.prototype.DrawPoint=function(p,size,color){var ctx=this.m_ctx;ctx.fillStyle=color.MakeStyleString(),size/=this.m_settings.viewZoom,size/=this.m_settings.canvasScale;var hsize=size/2;ctx.fillRect(p.x-hsize,p.y-hsize,size,size)},DebugDraw.prototype.DrawString=function(x,y){var ctx=this.m_ctx,args=Array.prototype.slice.call(arguments),string=goog.string.format.apply(null,args.slice(2));ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.font="18pt helvetica";var color=DebugDraw.prototype.DrawString.s_color;ctx.fillStyle=color.MakeStyleString(),ctx.fillText(string,x,y),ctx.restore()},DebugDraw.prototype.DrawString.s_color=new box2d.b2Color(.9,.6,.6),DebugDraw.prototype.DrawStringWorld=function(x,y){var p=DebugDraw.prototype.DrawStringWorld.s_p.SetXY(x,y),vt=this.m_settings.viewCenter;box2d.b2SubVV(p,vt,p);var vr=this.m_settings.viewRotation;box2d.b2MulTRV(vr,p,p);var vs=this.m_settings.viewZoom;box2d.b2MulSV(vs,p,p);var cs=this.m_settings.canvasScale;box2d.b2MulSV(cs,p,p),p.y*=-1;var cc=DebugDraw.prototype.DrawStringWorld.s_cc.SetXY(.5*this.m_canvas.width,.5*this.m_canvas.height);box2d.b2AddVV(p,cc,p);var ctx=this.m_ctx,args=Array.prototype.slice.call(arguments),string=goog.string.format.apply(null,args.slice(2));ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.font="18pt helvetica";var color=DebugDraw.prototype.DrawStringWorld.s_color;ctx.fillStyle=color.MakeStyleString(),ctx.fillText(string,p.x,p.y),ctx.restore()},DebugDraw.prototype.DrawStringWorld.s_p=new box2d.b2Vec2,DebugDraw.prototype.DrawStringWorld.s_cc=new box2d.b2Vec2,DebugDraw.prototype.DrawStringWorld.s_color=new box2d.b2Color(.5,.9,.5),DebugDraw.prototype.DrawAABB=function(aabb,color){var ctx=this.m_ctx;ctx.strokeStyle=color.MakeStyleString(),ctx.lineWidth=.03;var x=aabb.lowerBound.x,y=aabb.lowerBound.y,w=aabb.upperBound.x-aabb.lowerBound.x,h=aabb.upperBound.y-aabb.lowerBound.y;ctx.strokeRect(x,y,w,h)};